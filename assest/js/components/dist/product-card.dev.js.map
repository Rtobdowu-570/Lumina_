{"version":3,"sources":["product-card.js"],"names":["ProductCard","product","id","name","price","image","category","toLowerCase","trim","replace","rating","reviews","badge","description","quantity","isFeatured","isWhitelisted","originalPrice","card","document","createElement","className","dataset","innerHTML","generateStars","toFixed","attachEventListeners","output","i","Math","floor","element","addEventListener","e","btn","target","closest","action","stopPropagation","addToCart","whitelist","window","location","href","pb","authStore","isValid","showToast","setTimeout","userId","collection","getFirstListItem","existing","update","create","dispatchEvent","CustomEvent","detail","console","error","cardElement","querySelector","textContent","classList","toggle","message","toast","body","appendChild","remove"],"mappings":"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","sourcesContent":["import { getCurrentUser, pb } from \"../api/pocketbase.js\";\nclass ProductCard {\n  constructor(product) {\n    if (!product) return;\n    this.id = product.id;\n    this.name = product.name;\n    this.price = product.price;\n    this.image = `http://127.0.0.1:8090/api/files/products/${product.id}/${product.image}`;\n    this.category = product.category.toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, 'and');\n    this.rating = product.rating || 0;\n    this.reviews = product.reviews || 0;\n    this.badge = product.badge;\n    this.description = product.description;\n    this.quantity = product.quantity;\n    this.isFeatured = product.isFeatured || false;\n    this.isWhitelisted = product.isWhitelisted || false;\n    this.originalPrice = product.originalPrice;\n  }\n\n  render() {\n    const card = document.createElement(\"div\");\n    card.className = \"product-cards\";\n    card.dataset.id = this.id;\n    card.dataset.category = this.category;\n    card.dataset.price = this.price;\n    card.dataset.name = this.name;\n    card.dataset.rating = this.rating;\n    card.dataset.quantity = this.quantity;\n\n    card.innerHTML = `\n          <div class=\"product-card-home\">\n        ${this.quantity > 0 ? `<span class=\"product-badge badge-sale\">Sale</span>` : `<span class=\"product-badge badge-sold-out\">Sold Out</span>`}\n\n        <button class=\"whitelist-btn ${this.isWhitelisted ? \"active\" : \"\"}\" data-action=\"whitelist\">\n            ${this.isWhitelisted ? \"♥\" : \"♡\"}\n        </button>\n\n        <a href=\"product-detail.html?id=${this.id}\" class=\"product-image-home\">\n          <img src=\"${this.image}\" alt=\"${this.name}\" />\n        </a>\n        <div class=\"product-info-home\">\n          <span class=\"product-category-home\">${this.category}</span>\n          <h3 class=\"product-name-home\">${this.name}</h3>\n          <div class=\"product-rating\">\n                <span class=\"stars\">${this.generateStars()}</span>\n                <span class=\"rating-count\">${this.rating} (${this.reviews}) reviews</span>\n            </div>\n          <div class=\"product-footer-home\">\n            <div class=\"product-price-home\">\n              <span class=\"price-current\" data-price=\"${this.price}\">$${this.price.toFixed(2)}</span>\n              ${this.originalPrice ? `<span class=\"price-original\">$${this.originalPrice.toFixed(2)}</span>` : \"\"}\n            </div>\n            <button class=\"btn-icon\" aria-label=\"Add to cart\" data-action=\"add-to-cart\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>`\n    ;\n    this.attachEventListeners(card);\n    return card;\n  }\n\n  generateStars() {\n    let output = '';\n    for (let i = 0; i < 5; i++) {\n        if (i < Math.floor(this.rating)) {\n            output += `<span class=\"star filled\">★</span>`;\n        } else if (i < this.rating) {\n            output += `<span class=\"star half\">★</span>`;\n        } else {\n            output += `<span class=\"star\">☆</span>`;\n        }\n    }\n    return output;\n  }\n\n  attachEventListeners(element) {\n    element.addEventListener(\"click\", (e) => {\n      const btn = e.target.closest('button');\n      const action = btn ? btn.dataset.action : null;\n      if (action === \"add-to-cart\") {\n        e.stopPropagation();\n        e.stopPropagation();\n        this.addToCart(element);\n      } else if (action === \"whitelist\") {\n        e.stopPropagation();\n        this.whitelist(element);\n      } else {\n        window.location.href = `product-detail.html?id=${this.id}`;\n      }\n    });\n  }\n\nasync addToCart() {\n  if (!pb.authStore.isValid) {\n    this.showToast(\"Please login to add items to cart\");\n    setTimeout(() => { window.location.href = '/auth/login.html'; }, 1000);\n    return;\n  }\n\n  try {\n    const userId = getCurrentUser().id;\n    const existing = await pb.collection('cart').getFirstListItem(\n      `user=\"${userId}\" && product=\"${this.id}\"`\n    ).catch(() => null);\n\n    if (existing) {\n      await pb.collection('cart').update(existing.id, {\n        \"quantity\": existing.quantity + 1\n      });\n    } else {\n      await pb.collection('cart').create({\n        \"user\": userId,\n        \"product\": this.id,\n        \"quantity\": 1\n      });\n    }\n\n    this.showToast(\"Added to cart!\");\n    window.dispatchEvent(new CustomEvent(\"product-added-to-cart\", { detail: this }));\n  } catch (err) {\n    console.error(\"Error adding to cart:\", err);\n  }\n}\n\n  async whitelist(cardElement) {\n   this.isWhitelisted = !this.isWhitelisted;\n    const btn = cardElement.querySelector(\".whitelist-btn\");\n    const userId = getCurrentUser().id\n    btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n    btn.classList.toggle(\"active\", this.isWhitelisted);\n    try{\n    if(this.isWhitelisted) {\n      await pb.collection('products').update(this.id, {\n        \"whitelisted_by+\": userId\n      })\n      this.showToast(\"Added to Whitelist\");\n    } else {\n      await pb.collection('products').update(this.id, {\n                \"whitelisted_by-\": userId\n            });\n      this.showToast(\"Removed from Whitelist\");\n    }\n  } catch(err){\n        this.isWhitelisted = !this.isWhitelisted;\n        btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n        btn.classList.toggle(\"active\", this.isWhitelisted);\n        \n        console.error(\"Whitelist Error:\", err.message);\n        this.showToast(\"Failed to update whitelist\");\n  }\n  }\n\n  showToast(message) {\n    const toast = document.createElement(\"div\");\n    toast.className = \"toast\";\n    toast.innerHTML = message;\n    document.body.appendChild(toast);\n    setTimeout(() => {\n      toast.remove();\n    }, 2000);\n  }\n}\n\n\nexport { ProductCard };\n"],"file":"product-card.dev.js"}