{"version":3,"sources":["product-card.js"],"names":["_pocketbase","require","ProductCard","product","_classCallCheck","this","id","name","price","image","concat","category","toLowerCase","trim","replace","rating","reviews","badge","description","quantity","isFeatured","isWhitelisted","originalPrice","card","document","createElement","generateStars","toFixed","output","i","Math","floor","btn","e","element","_this","addEventListener","action","closest","stopPropagation","dataset","window","location","whitelist","href","pb","authStore","isValid","showToast","setTimeout","getFirstListItem","userId","collection","update","existing","create","user","dispatchEvent","CustomEvent","detail","console","error","_context","t0","cardElement","querySelector","getCurrentUser","textContent","classList","toggle","whitelisted_by+","whitelisted_by-","_context2","message","toast","className","innerHTML","body","appendChild","remove"],"mappings":"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","file":"product-card.min.js","sourcesContent":["import { getCurrentUser, pb } from \"../api/pocketbase.js\";\nclass ProductCard {\n  constructor(product) {\n    if (!product) return;\n    this.id = product.id;\n    this.name = product.name;\n    this.price = product.price;\n    this.image = `http://127.0.0.1:8090/api/files/products/${product.id}/${product.image}`;\n    this.category = product.category.toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, 'and');\n    this.rating = product.rating || 0;\n    this.reviews = product.reviews || 0;\n    this.badge = product.badge;\n    this.description = product.description;\n    this.quantity = product.quantity;\n    this.isFeatured = product.isFeatured || false;\n    this.isWhitelisted = product.isWhitelisted || false;\n    this.originalPrice = product.originalPrice;\n  }\n\n  render() {\n    const card = document.createElement(\"div\");\n    card.className = \"product-cards\";\n    card.dataset.id = this.id;\n    card.dataset.category = this.category;\n    card.dataset.price = this.price;\n    card.dataset.name = this.name;\n    card.dataset.rating = this.rating;\n    card.dataset.quantity = this.quantity;\n\n    card.innerHTML = `\n          <div class=\"product-card-home\">\n        ${this.quantity > 0 ? `<span class=\"product-badge badge-sale\">Sale</span>` : `<span class=\"product-badge badge-sold-out\">Sold Out</span>`}\n\n        <button class=\"whitelist-btn ${this.isWhitelisted ? \"active\" : \"\"}\" data-action=\"whitelist\">\n            ${this.isWhitelisted ? \"♥\" : \"♡\"}\n        </button>\n\n        <a href=\"product-detail.html?id=${this.id}\" class=\"product-image-home\">\n          <img src=\"${this.image}\" alt=\"${this.name}\" />\n        </a>\n        <div class=\"product-info-home\">\n          <span class=\"product-category-home\">${this.category}</span>\n          <h3 class=\"product-name-home\">${this.name}</h3>\n          <div class=\"product-rating\">\n                <span class=\"stars\">${this.generateStars()}</span>\n                <span class=\"rating-count\">${this.rating} (${this.reviews}) reviews</span>\n            </div>\n          <div class=\"product-footer-home\">\n            <div class=\"product-price-home\">\n              <span class=\"price-current\" data-price=\"${this.price}\">$${this.price.toFixed(2)}</span>\n              ${this.originalPrice ? `<span class=\"price-original\">$${this.originalPrice.toFixed(2)}</span>` : \"\"}\n            </div>\n            <button class=\"btn-icon\" aria-label=\"Add to cart\" data-action=\"add-to-cart\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>`\n    ;\n    this.attachEventListeners(card);\n    return card;\n  }\n\n  generateStars() {\n    let output = '';\n    for (let i = 0; i < 5; i++) {\n        if (i < Math.floor(this.rating)) {\n            output += `<span class=\"star filled\">★</span>`;\n        } else if (i < this.rating) {\n            output += `<span class=\"star half\">★</span>`;\n        } else {\n            output += `<span class=\"star\">☆</span>`;\n        }\n    }\n    return output;\n  }\n\n  attachEventListeners(element) {\n    element.addEventListener(\"click\", (e) => {\n      const btn = e.target.closest('button');\n      const action = btn ? btn.dataset.action : null;\n      if (action === \"add-to-cart\") {\n        e.stopPropagation();\n        e.stopPropagation();\n        this.addToCart(element);\n      } else if (action === \"whitelist\") {\n        e.stopPropagation();\n        this.whitelist(element);\n      } else {\n        window.location.href = `product-detail.html?id=${this.id}`;\n      }\n    });\n  }\n\nasync addToCart() {\n  if (!pb.authStore.isValid) {\n    this.showToast(\"Please login to add items to cart\");\n    setTimeout(() => { window.location.href = '/auth/login.html'; }, 1000);\n    return;\n  }\n\n  try {\n    const userId = getCurrentUser().id;\n    const existing = await pb.collection('cart').getFirstListItem(\n      `user=\"${userId}\" && product=\"${this.id}\"`\n    ).catch(() => null);\n\n    if (existing) {\n      await pb.collection('cart').update(existing.id, {\n        \"quantity\": existing.quantity + 1\n      });\n    } else {\n      await pb.collection('cart').create({\n        \"user\": userId,\n        \"product\": this.id,\n        \"quantity\": 1\n      });\n    }\n\n    this.showToast(\"Added to cart!\");\n    window.dispatchEvent(new CustomEvent(\"product-added-to-cart\", { detail: this }));\n  } catch (err) {\n    console.error(\"Error adding to cart:\", err);\n  }\n}\n\n  async whitelist(cardElement) {\n   this.isWhitelisted = !this.isWhitelisted;\n    const btn = cardElement.querySelector(\".whitelist-btn\");\n    const userId = getCurrentUser().id\n    btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n    btn.classList.toggle(\"active\", this.isWhitelisted);\n    try{\n    if(this.isWhitelisted) {\n      await pb.collection('products').update(this.id, {\n        \"whitelisted_by+\": userId\n      })\n      this.showToast(\"Added to Whitelist\");\n    } else {\n      await pb.collection('products').update(this.id, {\n                \"whitelisted_by-\": userId\n            });\n      this.showToast(\"Removed from Whitelist\");\n    }\n  } catch(err){\n        this.isWhitelisted = !this.isWhitelisted;\n        btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n        btn.classList.toggle(\"active\", this.isWhitelisted);\n        \n        console.error(\"Whitelist Error:\", err.message);\n        this.showToast(\"Failed to update whitelist\");\n  }\n  }\n\n  showToast(message) {\n    const toast = document.createElement(\"div\");\n    toast.className = \"toast\";\n    toast.innerHTML = message;\n    document.body.appendChild(toast);\n    setTimeout(() => {\n      toast.remove();\n    }, 2000);\n  }\n}\n\n\nexport { ProductCard };\n"]}