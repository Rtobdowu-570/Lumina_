{"version":3,"sources":["product-card.js"],"names":["_pocketbase","require","ProductCard","product","_classCallCheck","this","id","name","price","image","concat","category","toLowerCase","trim","replace","rating","reviews","badge","description","quantity","isFeatured","isWhitelisted","originalPrice","card","document","createElement","generateStars","toFixed","output","i","Math","floor","btn","e","addToCart","_this","element","addEventListener","stopPropagation","closest","action","dataset","whitelist","window","location","href","pb","authStore","isValid","showToast","user","model","existing","collection","update","create","data","dispatchEvent","CustomEvent","detail","console","error","_context","t0","cardElement","querySelector","textContent","classList","toggle","message","toast","className","innerHTML","body","appendChild","setTimeout","remove"],"mappings":"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","file":"product-card.min.js","sourcesContent":["import { pb } from \"../api/pocketbase.js\";\nclass ProductCard {\n  constructor(product) {\n    if (!product) return;\n    this.id = product.id;\n    this.name = product.name;\n    this.price = product.price;\n    this.image = `http://127.0.0.1:8090/api/files/products/${product.id}/${product.image}`;\n    this.category = product.category.toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, 'and');\n    this.rating = product.rating || 0;\n    this.reviews = product.reviews || 0;\n    this.badge = product.badge;\n    this.description = product.description;\n    this.quantity = product.quantity;\n    this.isFeatured = product.isFeatured || false;\n    this.isWhitelisted = product.isWhitelisted || false;\n    this.originalPrice = product.originalPrice;\n  }\n\n  render() {\n    const card = document.createElement(\"div\");\n    card.className = \"product-cards\";\n    card.dataset.id = this.id;\n    card.dataset.category = this.category;\n    card.dataset.price = this.price;\n    card.dataset.name = this.name;\n    card.dataset.rating = this.rating;\n    card.dataset.quantity = this.quantity;\n\n    card.innerHTML = `\n          <div class=\"product-card-home\">\n        ${this.quantity > 0 ? `<span class=\"product-badge badge-sale\">Sale</span>` : `<span class=\"product-badge badge-sold-out\">Sold Out</span>`}\n\n        <button class=\"whitelist-btn ${this.isWhitelisted ? \"active\" : \"\"}\" data-action=\"whitelist\">\n            ${this.isWhitelisted ? \"♥\" : \"♡\"}\n        </button>\n\n        <a href=\"product-detail.html?id=${this.id}\" class=\"product-image-home\">\n          <img src=\"${this.image}\" alt=\"${this.name}\" />\n        </a>\n        <div class=\"product-info-home\">\n          <span class=\"product-category-home\">${this.category}</span>\n          <h3 class=\"product-name-home\">${this.name}</h3>\n          <div class=\"product-rating\">\n                <span class=\"stars\">${this.generateStars()}</span>\n                <span class=\"rating-count\">${this.rating} (${this.reviews}) reviews</span>\n            </div>\n          <div class=\"product-footer-home\">\n            <div class=\"product-price-home\">\n              <span class=\"price-current\" data-price=\"${this.price}\">$${this.price.toFixed(2)}</span>\n              ${this.originalPrice ? `<span class=\"price-original\">$${this.originalPrice.toFixed(2)}</span>` : \"\"}\n            </div>\n            <button class=\"btn-icon\" aria-label=\"Add to cart\" data-action=\"add-to-cart\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>`\n    ;\n    this.attachEventListeners(card);\n    return card;\n  }\n\n  generateStars() {\n    let output = '';\n    for (let i = 0; i < 5; i++) {\n        if (i < Math.floor(this.rating)) {\n            output += `<span class=\"star filled\">★</span>`;\n        } else if (i < this.rating) {\n            output += `<span class=\"star half\">★</span>`;\n        } else {\n            output += `<span class=\"star\">☆</span>`;\n        }\n    }\n    return output;\n  }\n\n  attachEventListeners(element) {\n    element.addEventListener(\"click\", (e) => {\n      const btn = e.target.closest('button');\n      const action = btn ? btn.dataset.action : null;\n      if (action === \"add-to-cart\") {\n        e.stopPropagation();\n        this.addToCart();\n      } else if (action === \"whitelist\") {\n        e.stopPropagation();\n        this.whitelist(element);\n      } else {\n        window.location.href = `product-detail.html?id=${this.id}`;\n      }\n    });\n  }\n\n  async addToCart() {\n    if(!pb.authStore.isValid) {\n      this.showToast(\"Please login to add items to cart\");\n      window.location.href = '/auth/login.html';\n      return;\n    }\n\n    try{\n      const data = {\n            \"user\": pb.authStore.model.id,\n            \"product\": this.id,\n            \"quantity\": 1\n      }\n\n      const existing = await pb.collection('cart').getFirstListItem(\n            `user=\"${pb.authStore.model.id}\" && product=\"${this.id}\"`\n        ).catch(() => null)\n    \n\n    if(existing) {\n      await pb.collection('cart').update(existing.id, {\n                \"quantity\": existing.quantity + 1\n            });\n    }\n    else {\n      await pb.collection('cart').create(data);\n    }\n    this.showToast(\"Added to cart!\");\n    window.dispatchEvent(\n      new CustomEvent(\"product-added-to-cart\", { detail: this }),\n    );\n  }\n      catch(err){\n      console.error(\"Error adding to cart:\", err);\n    }\n  }\n\n  whitelist(cardElement) {\n   this.isWhitelisted = !this.isWhitelisted;\n    const btn = cardElement.querySelector(\".whitelist-btn\");\n    btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n    btn.classList.toggle(\"active\", this.isWhitelisted);\n    this.showToast(this.isWhitelisted ? \"Added to Whitelist\" : \"Removed from Whitelist\");\n  }\n\n  toggleWhitelist(element) {\n    if (!element) return;\n    \n    this.isWhitelisted = !this.isWhitelisted;\n    const btn = element.querySelector(\".whitelist-btn\");\n    btn.textContent = this.isWhitelisted ? \"♥\" : \"♡\";\n    btn.classList.toggle(\"active\", this.isWhitelisted);\n    this.showToast(\n      this.isWhitelisted ? \"Added to Whitelist\" : \"Removed from Whitelist\",\n    );\n  }\n\n  showToast(message) {\n    const toast = document.createElement(\"div\");\n    toast.className = \"toast\";\n    toast.innerHTML = message;\n    document.body.appendChild(toast);\n    setTimeout(() => {\n      toast.remove();\n    }, 2000);\n  }\n}\n\nexport { ProductCard };\n"]}