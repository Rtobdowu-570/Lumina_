"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProductCard=void 0;var _pocketbase=require("../api/pocketbase.js");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var ProductCard=function(){function e(t){_classCallCheck(this,e),t&&(this.id=t.id,this.name=t.name,this.price=t.price,this.image="http://127.0.0.1:8090/api/files/products/".concat(t.id,"/").concat(t.image),this.category=t.category.toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"and"),this.rating=t.rating||0,this.reviews=t.reviews||0,this.badge=t.badge,this.description=t.description,this.quantity=t.quantity,this.isFeatured=t.isFeatured||!1,this.isWhitelisted=t.isWhitelisted||!1,this.originalPrice=t.originalPrice)}return _createClass(e,[{key:"render",value:function(){var t=document.createElement("div");return t.className="product-cards",t.dataset.id=this.id,t.dataset.category=this.category,t.dataset.price=this.price,t.dataset.name=this.name,t.dataset.rating=this.rating,t.dataset.quantity=this.quantity,t.innerHTML='\n          <div class="product-card-home">\n        '.concat(0<this.quantity?'<span class="product-badge badge-sale">Sale</span>':'<span class="product-badge badge-sold-out">Sold Out</span>','\n\n        <button class="whitelist-btn ').concat(this.isWhitelisted?"active":"",'" data-action="whitelist">\n            ').concat(this.isWhitelisted?"♥":"♡",'\n        </button>\n\n        <a href="product-detail.html?id=').concat(this.id,'" class="product-image-home">\n          <img src="').concat(this.image,'" alt="').concat(this.name,'" />\n        </a>\n        <div class="product-info-home">\n          <span class="product-category-home">').concat(this.category,'</span>\n          <h3 class="product-name-home">').concat(this.name,'</h3>\n          <div class="product-rating">\n                <span class="stars">').concat(this.generateStars(),'</span>\n                <span class="rating-count">').concat(this.rating," (").concat(this.reviews,') reviews</span>\n            </div>\n          <div class="product-footer-home">\n            <div class="product-price-home">\n              <span class="price-current" data-price="').concat(this.price,'">$').concat(this.price.toFixed(2),"</span>\n              ").concat(this.originalPrice?'<span class="price-original">$'.concat(this.originalPrice.toFixed(2),"</span>"):"",'\n            </div>\n            <button class="btn-icon" aria-label="Add to cart" data-action="add-to-cart">\n            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n                <path d="M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z" stroke="currentColor" stroke-width="2"/>\n                <circle cx="7" cy="18" r="1" fill="currentColor"/>\n                <circle cx="16" cy="18" r="1" fill="currentColor"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>'),this.attachEventListeners(t),t}},{key:"generateStars",value:function(){for(var t="",e=0;e<5;e++)e<Math.floor(this.rating)?t+='<span class="star filled">★</span>':e<this.rating?t+='<span class="star half">★</span>':t+='<span class="star">☆</span>';return t}},{key:"attachEventListeners",value:function(i){var s=this;i.addEventListener("click",function(t){var e=t.target.closest("button"),a=e?e.dataset.action:null;"add-to-cart"===a?(t.stopPropagation(),t.stopPropagation(),s.addToCart(i)):"whitelist"===a?(t.stopPropagation(),s.whitelist(i)):window.location.href="product-detail.html?id=".concat(s.id)})}},{key:"addToCart",value:function(){var e,a;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(_pocketbase.pb.authStore.isValid){t.next=4;break}return this.showToast("Please login to add items to cart"),setTimeout(function(){window.location.href="/auth/login.html"},1e3),t.abrupt("return");case 4:return t.prev=4,e=(0,_pocketbase.getCurrentUser)().id,t.next=8,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFirstListItem('user="'.concat(e,'" && product="').concat(this.id,'"')).catch(function(){return null}));case 8:if(a=t.sent)return t.next=12,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(a.id,{quantity:a.quantity+1}));t.next=14;break;case 12:t.next=16;break;case 14:return t.next=16,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").create({user:e,product:this.id,quantity:1}));case 16:this.showToast("Added to cart!"),window.dispatchEvent(new CustomEvent("product-added-to-cart",{detail:this})),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(4),console.error("Error adding to cart:",t.t0);case 23:case"end":return t.stop()}},null,this,[[4,20]])}},{key:"whitelist",value:function(e){var a,i;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isWhitelisted=!this.isWhitelisted,a=e.querySelector(".whitelist-btn"),i=(0,_pocketbase.getCurrentUser)().id,a.textContent=this.isWhitelisted?"♥":"♡",a.classList.toggle("active",this.isWhitelisted),t.prev=5,this.isWhitelisted)return t.next=9,regeneratorRuntime.awrap(_pocketbase.pb.collection("products").update(this.id,{"whitelisted_by+":i}));t.next=12;break;case 9:this.showToast("Added to Whitelist"),t.next=15;break;case 12:return t.next=14,regeneratorRuntime.awrap(_pocketbase.pb.collection("products").update(this.id,{"whitelisted_by-":i}));case 14:this.showToast("Removed from Whitelist");case 15:t.next=24;break;case 17:t.prev=17,t.t0=t.catch(5),this.isWhitelisted=!this.isWhitelisted,a.textContent=this.isWhitelisted?"♥":"♡",a.classList.toggle("active",this.isWhitelisted),console.error("Whitelist Error:",t.t0.message),this.showToast("Failed to update whitelist");case 24:case"end":return t.stop()}},null,this,[[5,17]])}},{key:"showToast",value:function(t){var e=document.createElement("div");e.className="toast",e.innerHTML=t,document.body.appendChild(e),setTimeout(function(){e.remove()},2e3)}}]),e}();exports.ProductCard=ProductCard;
//# sourceMappingURL=product-card.min.js.map
