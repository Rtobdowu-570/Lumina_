{"version":3,"sources":["checkout.js"],"names":["cartItem","CartItem","showPaymentModal","PaymentModal","title","message","confirmText","cancelText","onConfirm","showToast","user","getCurrentUser","id","pb","collection","getFullList","filter","cartRecord","last","document","querySelector","toTal","console","log","cartItemIds","map","record","data","create","checkoutRecord","modal","classList","remove","setTimeout","onCancel","Modal","show","ValidateInput","inputs","Array","from","querySelectorAll","completeBtn","validate","hasEmpty","some","i","value","trim","disabled","add","innerHTML","forEach","addEventListener","e","preventDefault","getProductAddedToCart","shippingRate","expand","orderContent","first","second","third","subtotal","shipping","TAX_RATE","pd","productData","product","itemTotal","price","quantity","name","toFixed","tax","total","textContent","checkAuth","window","location","href","displayUsername","userName","user_name","authStore","model","logOut","clear","logOutBtn","multiTabs","tab","tabType","contains","t","options","option","feeValue","dataset","fee","toLowerCase","o","goBack"],"mappings":"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","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport {  Modal } from \"../components/modal.js\";\nimport { CartItem } from \"../components/cart-item.js\";\n\nconst cartItem = new CartItem();\n\nfunction showPaymentModal() {\n    const PaymentModal = {\n        title: \"Payment\",\n        message: \"Are you sure you want to proceed to payment?\",\n        confirmText: \"Confirm\",\n        cancelText: \"Cancel\",\n        onConfirm: async () => {\n            cartItem.showToast('Payment successful');\n            const user = getCurrentUser().id;\n            const cartRecord = await pb.collection('cart').getFullList({\n                filter: `user = \"${getCurrentUser().id}\"`\n            })\n\n            const last = document.querySelector('.last');\n            const toTal = last\n            console.log(toTal);\n\n            const cartItemIds = cartRecord.map(record => record.id);\n            const data = {\n            \"items\": cartItemIds,\n            \"user\": user,\n            \"successful\": true,\n            \"failed\": false,\n            \"total\": toTal\n        };\n        const checkoutRecord = await pb.collection('checkout').create(data);\n        cartItem.showToast(\"Payment Successful! Order Created.\");\n\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n        onCancel: () => {\n            cartItem.showToast('Payment failed');\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n    }\n    const modal = new Modal(PaymentModal);\n    modal.show();\n}\n\nfunction ValidateInput() {\n    const inputs = Array.from(document.querySelectorAll('input:not([type=\"hidden\"])'));\n    const completeBtn = document.querySelector('.complete');\n\n    if (!completeBtn) return;\n\n    function validate() {\n        const hasEmpty = inputs.some(i => !i.value || i.value.trim() === '');\n        \n        completeBtn.disabled = hasEmpty;\n\n        if (!hasEmpty) {\n            completeBtn.classList.add('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment âœ“';\n        } else {\n            completeBtn.classList.remove('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment'; \n        }\n\n        return hasEmpty;\n    }\n\n    inputs.forEach(i => i.addEventListener('input', validate));\n\n    validate();\n\n    completeBtn.addEventListener('click', (e) => {\n        e.preventDefault(); \n        showPaymentModal();\n    });\n}\n\nasync function getProductAddedToCart(shippingRate = 0.001) {\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    const orderContent = document.querySelector('.order-items');\n    const first = document.querySelector('.first');\n    const second = document.querySelector('.second');\n    const third = document.querySelector('.third');\n    const last = document.querySelector('.last');\n\n    let subtotal = 0;\n    let shipping = 0;\n    const TAX_RATE = 0.0005;\n\n    orderContent.innerHTML = '';\n    \n    data.forEach(pd => {\n        const productData = pd.expand.product;\n        const itemTotal = productData.price * pd.quantity;\n        subtotal += itemTotal;\n        shipping += productData.price * shippingRate * pd.quantity;\n\n        orderContent.innerHTML +=\n        `\n            <div class=\"order-item\">\n                <div class=\"item-info\">\n                    <span class=\"item-name\">${productData.name}</span>\n                    <span class=\"item-qty\">Qty: ${pd.quantity}</span>\n                </div>\n                <span class=\"item-price\">$${itemTotal.toFixed(2)}</span>\n            </div>\n        `\n    });\n\n    const tax = subtotal * TAX_RATE;\n    const total = subtotal + shipping + tax;\n\n    if (first) first.textContent = subtotal.toFixed(2);\n    if (second) second.textContent = shipping.toFixed(2);\n    if (third) third.textContent = tax.toFixed(2);\n    if (last) last.textContent = total.toFixed(2);\n}\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n    checkAuth();\n    displayUsername();\n    ValidateInput()\n    getProductAddedToCart()\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst multiTabs = document.querySelectorAll('.payment-option, .shipping-option');\nmultiTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n        const tabType = tab.classList.contains('payment-option') ? 'payment-option' : 'shipping-option';\n        document.querySelectorAll('.' + tabType).forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n    });\n});\n\nconst options = document.querySelectorAll('[data-fee]');\noptions.forEach(option => {\n    option.addEventListener('click', () => {\n        const feeValue = option.dataset.fee.toLowerCase();\n        document.querySelectorAll('[data-fee]').forEach(o => o.classList.remove('active'));\n        option.classList.add('active');\n        if(feeValue === 'standard') {\n           getProductAddedToCart(0.001);\n        } else if(feeValue === 'express') {\n            getProductAddedToCart(0.004);\n        } else if(feeValue === 'overnight') {\n            getProductAddedToCart(0.007);\n        }\n    })\n})\n\nconst goBack = document.querySelector('.return');\ngoBack.addEventListener('click', () => {\n    window.location.href = '/public/cart.html';\n})\n\n"],"file":"checkout.dev.js"}