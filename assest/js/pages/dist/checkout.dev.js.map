{"version":3,"sources":["checkout.js"],"names":["cartItem","CartItem","showPaymentModal","PaymentModal","title","message","confirmText","cancelText","onConfirm","showToast","user","getCurrentUser","id","pb","collection","getFullList","filter","cartRecord","cartItemIds","map","record","data","create","checkoutRecord","modal","document","querySelector","classList","remove","setTimeout","onCancel","Modal","show","ValidateInput","inputs","Array","from","querySelectorAll","completeBtn","validate","hasEmpty","some","i","value","trim","disabled","add","innerHTML","forEach","addEventListener","e","preventDefault","getProductAddedToCart","shippingRate","expand","orderContent","first","second","third","last","subtotal","shipping","TAX_RATE","pd","productData","product","itemTotal","price","quantity","name","toFixed","tax","total","textContent","checkAuth","window","location","href","displayUsername","userName","user_name","authStore","model","logOut","clear","logOutBtn","multiTabs","tab","tabType","contains","t","options","option","feeValue","dataset","fee","toLowerCase","o","goBack"],"mappings":"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","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport {  Modal } from \"../components/modal.js\";\nimport { CartItem } from \"../components/cart-item.js\";\n\nconst cartItem = new CartItem();\n\nfunction showPaymentModal() {\n    const PaymentModal = {\n        title: \"Payment\",\n        message: \"Are you sure you want to proceed to payment?\",\n        confirmText: \"Confirm\",\n        cancelText: \"Cancel\",\n        onConfirm: async () => {\n            cartItem.showToast('Payment successful');\n            const user = getCurrentUser().id;\n            const cartRecord = await pb.collection('cart').getFullList({\n                filter: `user = \"${getCurrentUser().id}\"`\n            })\n            const cartItemIds = cartRecord.map(record => record.id);\n            const data = {\n            \"items\": cartItemIds,\n            \"user\": user,\n            \"successful\": true,\n            \"failed\": false\n        };\n        const checkoutRecord = await pb.collection('checkout').create(data);\n        for (let id of cartItemIds) {\n            await pb.collection('cart').delete(id);\n        }\n        cartItem.showToast(\"Payment Successful! Order Created.\");\n\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n        onCancel: () => {\n            cartItem.showToast('Payment failed');\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n    }\n    const modal = new Modal(PaymentModal);\n    modal.show();\n}\n\nfunction ValidateInput() {\n    const inputs = Array.from(document.querySelectorAll('input:not([type=\"hidden\"])'));\n    const completeBtn = document.querySelector('.complete');\n\n    if (!completeBtn) return;\n\n    function validate() {\n        const hasEmpty = inputs.some(i => !i.value || i.value.trim() === '');\n        \n        completeBtn.disabled = hasEmpty;\n\n        if (!hasEmpty) {\n            completeBtn.classList.add('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment âœ“';\n        } else {\n            completeBtn.classList.remove('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment'; \n        }\n\n        return hasEmpty;\n    }\n\n    inputs.forEach(i => i.addEventListener('input', validate));\n\n    validate();\n\n    completeBtn.addEventListener('click', (e) => {\n        e.preventDefault(); \n        showPaymentModal();\n    });\n}\n\nasync function getProductAddedToCart(shippingRate = 0.001) {\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    const orderContent = document.querySelector('.order-items');\n    const first = document.querySelector('.first');\n    const second = document.querySelector('.second');\n    const third = document.querySelector('.third');\n    const last = document.querySelector('.last');\n\n    let subtotal = 0;\n    let shipping = 0;\n    const TAX_RATE = 0.0005;\n\n    orderContent.innerHTML = '';\n    \n    data.forEach(pd => {\n        const productData = pd.expand.product;\n        const itemTotal = productData.price * pd.quantity;\n        subtotal += itemTotal;\n        shipping += productData.price * shippingRate * pd.quantity;\n\n        orderContent.innerHTML +=\n        `\n            <div class=\"order-item\">\n                <div class=\"item-info\">\n                    <span class=\"item-name\">${productData.name}</span>\n                    <span class=\"item-qty\">Qty: ${pd.quantity}</span>\n                </div>\n                <span class=\"item-price\">$${itemTotal.toFixed(2)}</span>\n            </div>\n        `\n    });\n\n    const tax = subtotal * TAX_RATE;\n    const total = subtotal + shipping + tax;\n\n    if (first) first.textContent = subtotal.toFixed(2);\n    if (second) second.textContent = shipping.toFixed(2);\n    if (third) third.textContent = tax.toFixed(2);\n    if (last) last.textContent = total.toFixed(2);\n}\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n    checkAuth();\n    displayUsername();\n    ValidateInput()\n    getProductAddedToCart()\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst multiTabs = document.querySelectorAll('.payment-option, .shipping-option');\nmultiTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n        const tabType = tab.classList.contains('payment-option') ? 'payment-option' : 'shipping-option';\n        document.querySelectorAll('.' + tabType).forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n    });\n});\n\nconst options = document.querySelectorAll('[data-fee]');\noptions.forEach(option => {\n    option.addEventListener('click', () => {\n        const feeValue = option.dataset.fee.toLowerCase();\n        document.querySelectorAll('[data-fee]').forEach(o => o.classList.remove('active'));\n        option.classList.add('active');\n        if(feeValue === 'standard') {\n           getProductAddedToCart(0.001);\n        } else if(feeValue === 'express') {\n            getProductAddedToCart(0.004);\n        } else if(feeValue === 'overnight') {\n            getProductAddedToCart(0.007);\n        }\n    })\n})\n\nconst goBack = document.querySelector('.return');\ngoBack.addEventListener('click', () => {\n    window.location.href = '/public/cart.html';\n})\n\n"],"file":"checkout.dev.js"}