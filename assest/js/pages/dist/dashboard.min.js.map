{"version":3,"sources":["dashboard.js"],"names":["_pocketbase","require","_productCard","checkAuth","isAuthenticated","window","location","href","displayUsername","user","getCurrentUser","userName","document","querySelector","name","user_name","model","pb","authStore","clear","displayUserData","userId","output","container","regeneratorRuntime","async","_context","prev","next","abrupt","id","awrap","collection","getOne","logOut","sent","concat","avatar","email","innerHTML","console","warn","t0","stop","getStatusHTML","order","statusClass","statusText","delivered","shipped","successful","displayUserOrder","orderContainer","orderData","row","year","_context2","getFullList","filter","createElement","Date","getFullYear","forEach","failed","className","slice","toUpperCase","created","items","length","total","displayWhitelstedItems","whitelist","_context3","item","image","files","getURL","category","addEventListener","ProductCard","addToCart"],"mappings":"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","file":"dashboard.min.js","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport { ProductCard } from \"../components/product-card.js\";\n// prevent user from viewing dashboard if not logged in\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\nasync function displayUserData() {\n    if (!isAuthenticated()) return;\n    const userId = pb.authStore.model ? pb.authStore.model.id : null;\n    if (!userId) return;\n\n    try {\n        const user = await pb.collection('users').getOne(userId);\n\n        const output = `\n                <div class=\"stat-img\">\n                    <img src=\"${user.avatar || '/assest/images/placeholder.jpg'}\" alt=\"${user.name || ''}\" class=\"user-avatar stat\"></div>\n                <div class=\"stat-content user-data\">\n                    <div class=\"stat-value\">${user.name || ''} <span class=\"edit-profile-btn\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#FF5C5C\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path d=\"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z\"></path>\n                    </svg>\n                    </span></div>\n                    <div class=\"stat-label\">${user.email || ''}</div>\n                    <div class=\"stat-label\">${user.user_name || ''}</div>\n                </div>`;\n        \n        const container = document.querySelector('.user-stats');\n        if (container) {\n            container.innerHTML = output;\n        } else {\n            console.warn('No container found for user data');\n        }\n    } catch (err) {\n        console.error('Failed to fetch current user:', err);\n    }\n}\n\nfunction getStatusHTML(order) {\n    let statusClass = '';\n    let statusText = '';\n\n    if (order.delivered) {\n        statusClass = 'delivered';\n        statusText = 'Delivered';\n    } else if (order.shipped) {\n        statusClass = 'shipped';\n        statusText = 'Shipped';\n    } else if (order.successful) {\n        statusClass = 'delivered';\n        statusText = 'Successful';\n    } else if (order.failed) {\n        statusClass = 'failed';\n        statusText = 'Failed';\n    } else {\n        statusClass = 'processing';\n        statusText = 'Processing';\n    }\n\n    return `<span class=\"status-badge ${statusClass}\">${statusText}</span>`;\n}\n\nasync function displayUserOrder() {\n    const orderContainer = document.querySelector('.orders-table')\n    const userId = getCurrentUser().id;\n\n    const orderData = await pb.collection('checkout').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`\n    });\n    const row = document.createElement('div');\n    const year = new Date().getFullYear();\n    orderData.forEach(order => {\n\n        if(order.delivered === true || order.shipped === true || order.successful === true || order.failed === true) {\n        }\n\n        row.className = 'table-row';\n        row.innerHTML = `\n        <div class=\"table-cell\">#ORD-${year}-${(order.id).slice(0, 3).toUpperCase()}</div>\n        <div class=\"table-cell\">${order.created.slice(0, 10)}</div>\n        <div class=\"table-cell\">${order.items.length} items</div>\n        <div class=\"table-cell\">$${order.total}</div>\n        <div class=\"table-cell\">${getStatusHTML(order)}</div>\n        <div class=\"table-cell\"><button class=\"view-btn\">View</button></div>\n    `\n    })\n    orderContainer.appendChild(row);\n}\n\nasync function displayWhitelstedItems() {\n    const whitelist = document.querySelector('.whitelist-items');\n    whitelist.innerHTML ='';\n\n    const userId = getCurrentUser().id;\n    const whitelistedItems = await pb.collection('products').getFullList({\n        filter: `whitelisted_by ~ \"${getCurrentUser().id}\"`\n    }); \n\n    whitelistedItems.forEach(item => {\n        const image = item.image ? pb.files.getURL(item, item.image) : '/assest/images/placeholder.png';\n        \n        whitelist.innerHTML += `\n        <div class=\"product-card-home\">\n        <a href=\"product-detail.html?id=${item.id}\" class=\"product-image-home\">\n          <img src= \"${image}\" alt=\"${item.name}\" />\n        </a>\n        <div class=\"product-info-home\">\n          <span class=\"product-category-home\">${item.category}</span>\n          <h3 class=\"product-name-home\">${item.name}</h3>\n          <div class=\"product-footer-home\">\n            <button class=\"btn-icon\" aria-label=\"Add to cart\" data-action=\"add-to-cart\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n        `\n\n        const addToCartBtn = whitelist.querySelector(`[data-action=\"add-to-cart\"]`);\n        addToCartBtn.addEventListener('click', () => {\n            const productCard = new ProductCard();\n            productCard.addToCart(item);\n        });\n    })\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    checkAuth();\n    displayUsername();\n    displayUserData();\n    displayUserOrder();\n    displayWhitelstedItems();\n});\n\nexport { logOut, getCurrentUser, checkAuth, displayUsername };"]}