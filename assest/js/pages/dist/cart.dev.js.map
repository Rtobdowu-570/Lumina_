{"version":3,"sources":["cart.js"],"names":["cartItem","CartItem","displayCart","user","getCurrentUser","id","console","warn","pb","collection","getFullList","filter","expand","data","cartContainer","document","querySelector","forEach","pd","productData","product","log","cartSection","createElement","className","dataset","innerHTML","files","getURL","image","name","quantity","price","toFixed","originalPrice","appendChild","attachEventListeners","error","checkAuth","window","location","href","container","addEventListener","e","btn","target","closest","action","el","itemEl","previousElementSibling","parentElement","updateQuantity","row","toRemove","i","next","nextElementSibling","remove","dispatchEvent","CustomEvent","input","newQuantity","Number","parseInt","value","update","Math","max","change","sibling","current","newQty","displayUsername","userName","textContent","user_name","authStore","model","logOut","clear"],"mappings":"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","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            console.log(productData)\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${\n              pd.quantity\n            }\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction attachEventListeners(container) {\n    container.addEventListener('click', async (e) => {\n      const btn = e.target.closest('[data-action]');\n      if (!btn) return;\n      const action = btn.dataset.action;\n\n      let el = btn;\n      let itemEl = null;\n      while (el) {\n        if (el.dataset && el.dataset.id) {\n          itemEl = el;\n          break;\n        }\n        el = el.previousElementSibling || el.parentElement;\n      }\n      if (!itemEl) return;\n      const id = itemEl.dataset.id;\n\n      if (action === 'increase') {\n        await updateQuantity(1, id);\n      } else if (action === 'decrease') {\n        await updateQuantity(-1, id);\n      } else if (action === 'remove') {\n        try {\n          await pb.collection('cart').delete(id);\n          const row = document.querySelector(`[data-id=\"${id}\"]`);\n          if (row) {\n            let toRemove = row;\n            for (let i = 0; i < 4; i++) {\n              const next = toRemove.nextElementSibling;\n              toRemove.remove();\n              if (!next) break;\n              toRemove = next;\n            }\n          }\n          window.dispatchEvent(new CustomEvent('cart-updated'));\n        } catch (err) {\n          console.error('Failed to remove cart item:', err);\n        }\n      }\n    });\n\n    container.addEventListener('change', async (e) => {\n      const input = e.target.closest('input[data-action=\"quantity\"]');\n      if (!input) return;\n      const newQuantity = Number.parseInt(input.value) || 1;\n\n      let el = input;\n      let itemEl = null;\n      while (el) {\n        if (el.dataset && el.dataset.id) {\n          itemEl = el;\n          break;\n        }\n        el = el.previousElementSibling || el.parentElement;\n      }\n      if (!itemEl) return;\n      const id = itemEl.dataset.id;\n\n      try {\n        await pb.collection('cart').update(id, { quantity: Math.max(1, newQuantity) });\n        window.dispatchEvent(new CustomEvent('cart-updated'));\n      } catch (err) {\n        console.error('Failed to update quantity:', err);\n      }\n    });\n  }\n\nasync function updateQuantity(change, id) {\n      try {\n        const itemEl = document.querySelector(`[data-id=\"${id}\"]`);\n        if (!itemEl) return;\n\n        let sibling = itemEl.nextElementSibling;\n        let input = null;\n        while (sibling) {\n          input = sibling.querySelector && sibling.querySelector('input[data-action=\"quantity\"]');\n          if (input) break;\n          sibling = sibling.nextElementSibling;\n        }\n        if (!input) return;\n\n        const current = Number.parseInt(input.value) || 1;\n        const newQty = Math.max(1, current + change);\n        input.value = newQty;\n\n        await pb.collection('cart').update(id, { quantity: newQty });\n        window.dispatchEvent(new CustomEvent('cart-updated'));\n      } catch (err) {\n        console.error('Failed to update quantity:', err);\n      }\n    }\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n});\n"],"file":"cart.dev.js"}