{"version":3,"sources":["cart.js"],"names":["cartItem","CartItem","searchCart","query","cartItems","document","querySelectorAll","lowerQuery","toLowerCase","forEach","item","name","querySelector","itemName","textContent","lowerItemName","includes","style","display","displayCart","user","getCurrentUser","id","console","warn","pb","collection","getFullList","filter","expand","data","cartContainer","pd","productData","product","cartSection","createElement","className","dataset","innerHTML","files","getURL","image","quantity","price","toFixed","originalPrice","appendChild","attachEventListeners","error","addEventListener","e","btn","target","closest","action","updateQuantity","remove","input","value","currentQuantity","parseInt","update","calculateItemPrice","paymentSummary","subtotal","paymentData","shipping","tax","total","length","checkAuth","window","location","href","displayUsername","userName","user_name","authStore","model","logOut","clear","logOutBtn","checkOut","continueShopping","search","searchItem","check"],"mappings":"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","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\n\nfunction searchCart(query) {\n    const cartItems = document.querySelectorAll('.cart-item');\n    const lowerQuery = query.toLowerCase();\n\n    cartItems.forEach(item => {\n        const name = item.querySelector('.item-name')\n        if(!name) return;\n\n        let itemName = name.textContent\n        const lowerItemName = itemName.toLowerCase();\n        if(lowerItemName.includes(lowerQuery)) {\n            item.style.display = 'flex';\n        }\n        else {\n            item.style.display = 'none';\n        }\n    })\n}\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${pd.quantity}\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\n\n function attachEventListeners(item) {\n    item.addEventListener('click', async (e) => {\n        const btn = e.target.closest('button');\n        const action = btn ? btn.dataset.action : null;\n        if (action === \"decrease\") {\n            await updateQuantity(item, action)\n        } else if (action === \"increase\") {\n            await updateQuantity(item, action)\n        } else if (action === \"remove\") {\n            cartItem.remove(item);\n        }\n    })\n}\n\nasync function updateQuantity(item, action) {\n    const input = item.querySelector('[data-action=\"quantity\"]');\n    const quantity = input.value;\n    const currentQuantity = parseInt(quantity);\n\n    if(action === \"increase\") {\n        input.value = currentQuantity + 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity + 1\n        })\n    } else if(action === \"decrease\") {\n        input.value = currentQuantity - 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity - 1\n        })\n    }\n}\n\nasync function calculateItemPrice() {\n    const paymentSummary = document.querySelector('.summary-details');\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    let subtotal = 0;\n    data.forEach(pd => {\n        const paymentData = pd.expand.product;\n        subtotal += pd.quantity * paymentData.price;\n    });\n\n    const shipping = subtotal * 0.01;\n    const tax = (subtotal * 0.01) * 0.05;\n    const total = subtotal + shipping + tax;\n\n    paymentSummary.innerHTML = \n    `\n        <div class=\"summary-row\">\n            <span>Subtotal (<span id=\"total-items\">${data.length}</span> ${data.length > 1 ? 'items' : 'item'})</span>\n            <span id=\"subtotal\">$${subtotal.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Shipping</span>\n            <span id=\"shipping\">$${shipping.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Tax</span>\n            <span id=\"tax\">$${tax.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row discount\" id=\"discount-row\" style=\"display: none\">\n            <span>Discount</span>\n            <span id=\"discount\">-$0.00</span>\n        </div>\n        <div class=\"summary-divider\"></div>\n        <div class=\"summary-row total\">\n            <span>Total</span>\n            <span id=\"total\">$${total.toFixed(2)}</span>\n        </div>\n    `\n}\n\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n    calculateItemPrice();\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst checkOut = document.querySelector('.checkout-btn');\ncheckOut.addEventListener('click', () => {\n    window.location.href = '/public/checkout.html';\n});\n\nconst continueShopping = document.querySelector('.continue-shopping-btn');\ncontinueShopping.addEventListener('click', () => {\n    window.location.href = '/public/products.html';\n});\n\nconst search = document.querySelector('.search-input')\nsearch.addEventListener('input', () => {\n    const searchItem = search.value;\n    searchCart(searchItem);\n});\n\nconst check = document.querySelector('.dashboard, .cart, .orders, .analytics, .settings');\nif (check) {\n  check.addEventListener('click', () => {\n   if(!isAuthenticated()) {\n    window.location.href = '/public/auth/auth.html';\n   }\n  });\n}\n\nexport { calculateItemPrice, checkAuth, displayUsername, logOut, getCurrentUser };"],"file":"cart.dev.js"}