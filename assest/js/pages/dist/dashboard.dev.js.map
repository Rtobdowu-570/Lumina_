{"version":3,"sources":["dashboard.js"],"names":["checkAuth","window","location","href","displayUsername","user","getCurrentUser","userName","document","querySelector","name","textContent","user_name","pb","authStore","model","logOut","clear","displayUserData","userId","id","collection","getOne","output","avatar","email","container","innerHTML","console","warn","error","getStatusHTML","order","statusClass","statusText","delivered","shipped","successful","failed","displayUserOrder","orderContainer","getFullList","filter","orderData","row","createElement","year","Date","getFullYear","forEach","className","slice","toUpperCase","created","items","length","total","appendChild","displayWhitelstedItems","whitelist","whitelistedItems","item","image","files","getURL","category","addToCartBtn","addEventListener","productCard","ProductCard","addToCart"],"mappings":"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","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport { ProductCard } from \"../components/product-card.js\";\n// prevent user from viewing dashboard if not logged in\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\nasync function displayUserData() {\n    if (!isAuthenticated()) return;\n    const userId = pb.authStore.model ? pb.authStore.model.id : null;\n    if (!userId) return;\n\n    try {\n        const user = await pb.collection('users').getOne(userId);\n\n        const output = `\n                <div class=\"stat-img\">\n                    <img src=\"${user.avatar || '/assest/images/placeholder.jpg'}\" alt=\"${user.name || ''}\" class=\"user-avatar stat\"></div>\n                <div class=\"stat-content user-data\">\n                    <div class=\"stat-value\">${user.name || ''} <span class=\"edit-profile-btn\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#FF5C5C\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path d=\"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z\"></path>\n                    </svg>\n                    </span></div>\n                    <div class=\"stat-label\">${user.email || ''}</div>\n                    <div class=\"stat-label\">${user.user_name || ''}</div>\n                </div>`;\n        \n        const container = document.querySelector('.user-stats');\n        if (container) {\n            container.innerHTML = output;\n        } else {\n            console.warn('No container found for user data');\n        }\n    } catch (err) {\n        console.error('Failed to fetch current user:', err);\n    }\n}\n\nfunction getStatusHTML(order) {\n    let statusClass = '';\n    let statusText = '';\n\n    if (order.delivered) {\n        statusClass = 'delivered';\n        statusText = 'Delivered';\n    } else if (order.shipped) {\n        statusClass = 'shipped';\n        statusText = 'Shipped';\n    } else if (order.successful) {\n        statusClass = 'delivered';\n        statusText = 'Successful';\n    } else if (order.failed) {\n        statusClass = 'failed';\n        statusText = 'Failed';\n    } else {\n        statusClass = 'processing';\n        statusText = 'Processing';\n    }\n\n    return `<span class=\"status-badge ${statusClass}\">${statusText}</span>`;\n}\n\nasync function displayUserOrder() {\n    const orderContainer = document.querySelector('.orders-table')\n    const userId = getCurrentUser().id;\n\n    const orderData = await pb.collection('checkout').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`\n    });\n    const row = document.createElement('div');\n    const year = new Date().getFullYear();\n    orderData.forEach(order => {\n\n        if(order.delivered === true || order.shipped === true || order.successful === true || order.failed === true) {\n        }\n\n        row.className = 'table-row';\n        row.innerHTML = `\n        <div class=\"table-cell\">#ORD-${year}-${(order.id).slice(0, 3).toUpperCase()}</div>\n        <div class=\"table-cell\">${order.created.slice(0, 10)}</div>\n        <div class=\"table-cell\">${order.items.length} items</div>\n        <div class=\"table-cell\">$${order.total}</div>\n        <div class=\"table-cell\">${getStatusHTML(order)}</div>\n        <div class=\"table-cell\"><button class=\"view-btn\">View</button></div>\n    `\n    })\n    orderContainer.appendChild(row);\n}\n\nasync function displayWhitelstedItems() {\n    const whitelist = document.querySelector('.whitelist-items');\n    whitelist.innerHTML ='';\n\n    const userId = getCurrentUser().id;\n    const whitelistedItems = await pb.collection('products').getFullList({\n        filter: `whitelisted_by ~ \"${getCurrentUser().id}\"`\n    }); \n\n    whitelistedItems.forEach(item => {\n        const image = item.image ? pb.files.getURL(item, item.image) : '/assest/images/placeholder.png';\n        \n        whitelist.innerHTML += `\n        <div class=\"product-card-home\">\n        <a href=\"product-detail.html?id=${item.id}\" class=\"product-image-home\">\n          <img src= \"${image}\" alt=\"${item.name}\" />\n        </a>\n        <div class=\"product-info-home\">\n          <span class=\"product-category-home\">${item.category}</span>\n          <h3 class=\"product-name-home\">${item.name}</h3>\n          <div class=\"product-footer-home\">\n            <button class=\"btn-icon\" aria-label=\"Add to cart\" data-action=\"add-to-cart\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n        `\n\n        const addToCartBtn = whitelist.querySelector(`[data-action=\"add-to-cart\"]`);\n        addToCartBtn.addEventListener('click', () => {\n            const productCard = new ProductCard();\n            productCard.addToCart(item);\n        });\n    })\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    checkAuth();\n    displayUsername();\n    displayUserData();\n    displayUserOrder();\n    displayWhitelstedItems();\n});\n\nexport { logOut, getCurrentUser, checkAuth, displayUsername };"],"file":"dashboard.dev.js"}