"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logOut=logOut,exports.getCurrentUser=getCurrentUser,exports.checkAuth=checkAuth,exports.displayUsername=displayUsername;var _pocketbase=require("../api/pocketbase.js"),_productCard=require("../components/product-card.js");function checkAuth(){(0,_pocketbase.isAuthenticated)()||(window.location.href="/public/auth/auth.html")}function displayUsername(){var e=getCurrentUser(),t=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?e.name?t.textContent=e.name:t.textContent=e.user_name:t.textContent="Guest"}function getCurrentUser(){return _pocketbase.pb.authStore.model}function logOut(){_pocketbase.pb.authStore.clear(),window.location.href="/auth/login.html"}function displayUserData(){var t,n,a,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_pocketbase.isAuthenticated)()){e.next=2;break}return e.abrupt("return");case 2:if(t=_pocketbase.pb.authStore.model?_pocketbase.pb.authStore.model.id:null){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,regeneratorRuntime.awrap(_pocketbase.pb.collection("users").getOne(t));case 8:n=e.sent,a='\n                <div class="stat-img">\n                    <img src="'.concat(n.avatar||"/assest/images/placeholder.jpg",'" alt="').concat(n.name||"",'" class="user-avatar stat"></div>\n                <div class="stat-content user-data">\n                    <div class="stat-value">').concat(n.name||"",' <span class="edit-profile-btn">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FF5C5C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>\n                    </svg>\n                    </span></div>\n                    <div class="stat-label">').concat(n.email||"",'</div>\n                    <div class="stat-label">').concat(n.user_name||"","</div>\n                </div>"),(r=document.querySelector(".user-stats"))?r.innerHTML=a:console.warn("No container found for user data"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("Failed to fetch current user:",e.t0);case 17:case"end":return e.stop()}},null,null,[[5,14]])}function getStatusHTML(e){var t="",n="";return n=e.delivered?(t="delivered","Delivered"):e.shipped?(t="shipped","Shipped"):e.successful?(t="delivered","Successful"):e.failed?(t="failed","Failed"):(t="processing","Processing"),'<span class="status-badge '.concat(t,'">').concat(n,"</span>")}function displayUserOrder(){var t,n,a,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector(".orders-table"),getCurrentUser().id,e.next=4,regeneratorRuntime.awrap(_pocketbase.pb.collection("checkout").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"')}));case 4:n=e.sent,a=document.createElement("div"),r=(new Date).getFullYear(),n.forEach(function(e){!0===e.delivered||!0===e.shipped||!0===e.successful||e.failed,a.className="table-row",a.innerHTML='\n        <div class="table-cell">#ORD-'.concat(r,"-").concat(e.id.slice(0,3).toUpperCase(),'</div>\n        <div class="table-cell">').concat(e.created.slice(0,10),'</div>\n        <div class="table-cell">').concat(e.items.length,' items</div>\n        <div class="table-cell">$').concat(e.total,'</div>\n        <div class="table-cell">').concat(getStatusHTML(e),'</div>\n        <div class="table-cell"><button class="view-btn">View</button></div>\n    ')}),t.appendChild(a);case 9:case"end":return e.stop()}})}function displayWhitelstedItems(){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.querySelector(".whitelist-items")).innerHTML="",getCurrentUser().id,e.next=5,regeneratorRuntime.awrap(_pocketbase.pb.collection("products").getFullList({filter:'whitelisted_by ~ "'.concat(getCurrentUser().id,'"')}));case 5:e.sent.forEach(function(e){var t=e.image?_pocketbase.pb.files.getURL(e,e.image):"/assest/images/placeholder.png";n.innerHTML+='\n        <div class="product-card-home">\n        <a href="product-detail.html?id='.concat(e.id,'" class="product-image-home">\n          <img src= "').concat(t,'" alt="').concat(e.name,'" />\n        </a>\n        <div class="product-info-home">\n          <span class="product-category-home">').concat(e.category,'</span>\n          <h3 class="product-name-home">').concat(e.name,'</h3>\n          <div class="product-footer-home">\n            <button class="btn-icon" aria-label="Add to cart" data-action="add-to-cart">\n            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n                <path d="M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z" stroke="currentColor" stroke-width="2"/>\n                <circle cx="7" cy="18" r="1" fill="currentColor"/>\n                <circle cx="16" cy="18" r="1" fill="currentColor"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n        '),n.querySelector('[data-action="add-to-cart"]').addEventListener("click",function(){(new _productCard.ProductCard).addToCart(e)})});case 7:case"end":return e.stop()}})}document.addEventListener("DOMContentLoaded",function(){checkAuth(),displayUsername(),displayUserData(),displayUserOrder(),displayWhitelstedItems()});
//# sourceMappingURL=dashboard.min.js.map
