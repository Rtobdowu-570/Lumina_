"use strict";var _productCard=require("../components/product-card.js"),_pocketbase=require("../api/pocketbase.js"),_products=require("./products.js");function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ProductDetail=function(){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).productData=t,e.isWhitelisted=!1,e}return _inherits(n,_productCard.ProductCard),_createClass(n,[{key:"addToCart",value:function(e){var n,r,a,i,o=arguments;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<o.length&&void 0!==o[1]?o[1]:1,t.prev=1,_pocketbase.pb.authStore.isValid){t.next=5;break}return window.location.href="auth.html",t.abrupt("return");case 5:return r=_pocketbase.pb.authStore.model.id,a=e.id,t.next=9,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFirstListItem('user="'.concat(_pocketbase.pb.authStore.model.id,'" && product="').concat(a,'"')).catch(function(){return null}));case 9:if(i=t.sent)return t.next=13,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(i.id,{quantity:i.quantity+n}));t.next=15;break;case 13:t.next=17;break;case 15:return t.next=17,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").create({user:r,product:e.id,quantity:n}));case 17:this.showToast("Added to cart!"),window.dispatchEvent(new CustomEvent("product-added-to-cart",{detail:this})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(1),console.error("Error adding to cart:",t.t0),this.showToast("Failed to add to cart");case 25:case"end":return t.stop()}},null,this,[[1,21]])}},{key:"addWhitelist",value:function(){this.isWhitelisted=!this.isWhitelisted;var t=document.querySelector(".white-list");this.isWhitelisted?t.textContent="â™¥":t.textContent="â™¡",t.classList.toggle("active",this.isWhitelisted),this.showToast(this.isWhitelisted?"Added to Whitelist":"Removed from Whitelist")}},{key:"getProduct",value:function(){var e,n,r,a,i;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new URLSearchParams(window.location.search),n=e.get("id")){t.next=5;break}return console.error("Product ID not found in URL"),t.abrupt("return");case 5:return t.prev=5,t.next=8,regeneratorRuntime.awrap(_pocketbase.pb.collection("products").getOne(n));case 8:return r=t.sent,t.next=11,regeneratorRuntime.awrap(_pocketbase.pb.collection("products").getList(1,4,{filter:'category = "'.concat(r.category,'" && id != "').concat(n,'"')}));case 11:a=t.sent,r,i=a.items,this.renderProduct(r,i||[]),this.setupEventListeners(r,i||[]),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("Error fetching product:",t.t0),this.showToast("Failed to fetch product");case 22:case"end":return t.stop()}},null,this,[[5,18]])}},{key:"displayUserName",value:function(){var t=this.getCurrentUser(),e=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?t.name?e.textContent=t.name:e.textContent=t.user_name:e.textContent="Guest"}},{key:"getCurrentUser",value:function(){return _pocketbase.pb.authStore.model}},{key:"logOut",value:function(){_pocketbase.pb.authStore.clear(),window.location.href="index.html"}},{key:"setupEventListeners",value:function(e,a){var i=this,t=document.querySelector(".btn-add-cart"),n=document.querySelector(".qty-input");t.addEventListener("click",function(){var t=parseInt(n.value)||1;i.addToCart(e,t)}),document.querySelector(".related-products-grid").addEventListener("click",function(t){var e=t.target.closest(".cart-btn");if(e){var n=e.dataset.id,r=a.find(function(t){return t.id===n});r&&i.addToCart(r,1)}}),document.querySelectorAll(".qty-btn").forEach(function(e){e.addEventListener("click",function(){var t=parseInt(n.value)||1;"+"===e.textContent?t+=1:"-"===e.textContent&&1<t&&(t-=1),n.value=t})});var r=document.querySelector(".white-list");r.addEventListener("click",function(){i.addWhitelist(r)});var o=document.querySelectorAll(".tab-btn"),c=document.querySelectorAll(".tab-pane");o.forEach(function(t,e){t.addEventListener("click",function(){o.forEach(function(t){return t.classList.remove("active")}),c.forEach(function(t){return t.classList.remove("active")}),t.classList.add("active"),c[e].classList.add("active")})}),document.querySelector(".copy").addEventListener("click",function(){!function(t){var e=this;navigator.clipboard.writeText(t).then(function(){e.showToast("Product link copied to clipboard!")}).catch(function(t){console.error("Failed to copy: ",t)})}("".concat("http://127.0.0.1:5500/","product-detail.html?id=").concat(e.id))})}},{key:"renderProduct",value:function(t,e){function n(t){return t.image?_pocketbase.pb.files.getURL(t,t.image):"/assest/images/placeholder.png"}var r=document.querySelector(".main-content"),a=0<e.length?e.map(function(t){return'\n                <a href="product-detail.html?id='.concat(t.id,'">\n                    <div class="product-card"">\n                        <div class="product-image-container">\n                            <img src=').concat(n(t),' alt="').concat(t.name,'">\n                            <div class="product-actions">\n                                <button class="cart-btn" data-id="').concat(t.id,'>Add to Cart\n                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n                                <path d="M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z" stroke="currentColor" stroke-width="2"/>\n                                <circle cx="7" cy="18" r="1" fill="currentColor"/>\n                                <circle cx="16" cy="18" r="1" fill="currentColor"/>\n                                </svg>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="product-info">\n                            <div class="product-category">').concat(t.category,'</div>\n                            <div class="product-name">').concat(t.name,'</div>\n                            <div class="product-rating">\n                                <span class="rating-value">').concat(t.rating,'</span>\n                            </div>\n                            <div class="product-price">\n                                <span class="current-price">').concat(t.price,"</span>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n                ")}).join(""):"<p>No related products found.</p>";r.innerHTML='\n            <div class="breadcrumb">\n                <a href="dashboard.html">Home</a>\n                <span>/</span>\n                <a href="products.html">Products</a>\n                <span>/</span>\n                <span class="current">'.concat(t.name,'</span>\n            </div>\n\n            <div class="product-detail-layout">\n                <div class="product-images">\n                    <div class="main-image">\n                        <img src="').concat(n(t),'" alt="ProductName">\n                    </div>\n                </div>\n\n                <div class="product-details">\n                    <div class="product-header">\n                        <div>\n                            <h1 class="product-title">').concat(t.name,'</h1>\n                            <div class="product-rating-detail">\n                                <div class="star">').concat(new _productCard.ProductCard(t).generateStars(),'</div>\n                                <span class="rating-text">').concat(t.rating,'</span>\n                            </div>\n                        </div>\n                        <div class="product-actions-header">\n                            <button class="icon-btn white-list">â™¡</button>\n                            <button class="icon-btn" copy>ðŸ”—</button>\n                        </div>\n                    </div>\n\n                    <div class="product-price-detail">\n                        <span class="current-price">').concat(t.price,'</span>\n                        <span class="original-price">').concat(t.originalPrice,'</span>\n                        <span class="save-badge">Save ').concat(t.originalPrice-t.price,'</span>\n                    </div>\n\n                    <p class="product-description">').concat(t.description,' </p>\n\n\n                    <div class="product-purchase">\n                        <div class="quantity-selector">\n                            <button class="qty-btn">-</button>\n                            <input type="number" value="1" min="1" title="qty-btn" class="qty-input"/>\n                            <button class="qty-btn">+</button>\n                        </div>\n                        <button class="btn-add-cart">Add to Cart \n                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n                            <path d="M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z" stroke="currentColor" stroke-width="2"/>\n                            <circle cx="7" cy="18" r="1" fill="currentColor"/>\n                            <circle cx="16" cy="18" r="1" fill="currentColor"/></svg>\n                        </button>\n                    </div>\n\n                    <div class="product-info-section">\n                        <div class="info-item">\n                            <span class="info-label">Stock:</span>\n                            <span class="info-value in-stock">').concat(0<t.quantity?"In Stock":"Out of Stock",'</span>\n                        </div>\n                        <div class="info-item">\n                            <span class="info-label">Warranty:</span>\n                            <span class="info-value">2 Years</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="product-tabs">\n                <div class="tabs-header">\n                    <button class="tab-btn active">Reviews</button>\n                    <button class="tab-btn">Shipping Info</button>\n                </div>\n                <div class="tabs-content">\n                    <div id="reviews" class="tab-pane active">\n                        <div class="reviews-section">\n                            <div class="reviews-summary">\n                                <div class="overall-rating">\n                                    <div class="rating-number">').concat(t.rating,'</div>\n                                    <div class="rating-stars">').concat(new _productCard.ProductCard(t).generateStars(),'</div>\n                                    <div class="reviews-count">Based on ').concat(t.reviews,' reviews</div>\n                                </div>\n                                <button class="write-review-btn btn">Write Review</button>\n                            </div>\n                            <div class="review-item">\n                                <div class="review-header">\n                                    <strong></strong>\n                                    <span class="review-date"></span>\n                                </div>\n                                <div class="review-rating"></div>\n                                <p class="review-text"></p>\n                            </div>\n                        </div>\n                    </div>\n                    <div id="shipping" class="tab-pane">\n                        <div class="shipping-info">\n                            <h3>Free Shipping</h3>\n                            <p>Free delivery on orders over $50. Estimated delivery: 3-5 business days.</p>\n                            <h3>Returns</h3>\n                            <p>30-day return policy. Free returns for unwanted items in original condition.</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <section class="related-products">\n                <h2 class="section-title">You Might Also Like</h2>\n                <div class="related-products-grid">\n                ').concat(a,"\n            </div>\n            </section>\n        ")}}]),n}(),detail=new ProductDetail;document.addEventListener("DOMContentLoaded",function(){detail.getProduct(),detail.displayUserName()});var home=document.querySelector(".logo-text");home.addEventListener("click",function(){window.location.href="/public/index.html"});var logOutBtn=document.querySelector(".log-out");logOutBtn.addEventListener("click",function(){detail.logOut()});
//# sourceMappingURL=product-detail.min.js.map
