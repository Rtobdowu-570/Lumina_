{"version":3,"sources":["product-detail.js"],"names":["_productCard","require","_pocketbase","_products","ProductDetail","productData","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","isWhitelisted","ProductCard","product","quantity","pb","authStore","isValid","window","location","href","userId","model","id","productId","collection","getFirstListItem","concat","existing","update","create","user","showToast","dispatchEvent","CustomEvent","detail","console","error","_context","t0","btn","document","querySelector","textContent","classList","toggle","search","getOne","getList","filter","category","relatedRecords","relatedProducts","setupEventListeners","_context2","getCurrentUser","isAuthenticated","name","userName","user_name","clear","_this2","addToCartBtn","qtyInput","value","addToCart","addEventListener","e","target","closest","dataset","relatedProduct","find","p","querySelectorAll","forEach","urlParams","URLSearchParams","get","currentQty","wishlistBtn","addWhitelist","tabButtons","index","b","remove","tabPanes","pane","add","text","_this3","navigator","clipboard","writeText","then","err","copyToClipboard","getImgUrl","item","image","files","getURL","main","relatedHtml","length","map","prod","rating","price","join","innerHTML","generateStars","originalPrice","description","reviews","getProduct","displayUserName","home","logOutBtn","logOut"],"mappings":"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","file":"product-detail.min.js","sourcesContent":["import { ProductCard } from \"../components/product-card.js\";\nimport { pb, isAuthenticated } from \"../api/pocketbase.js\";\nimport { UI } from \"./products.js\";\n\nclass ProductDetail extends ProductCard {\n  constructor(productData) {\n    super(productData);\n    this.productData = productData;\n    this.isWhitelisted = false;\n  }\n\n  async addToCart(product, quantity = 1) {\n    try {\n      if (!pb.authStore.isValid) {\n      window.location.href = \"auth.html\";\n      return;\n    }\n\n      const userId = pb.authStore.model.id;\n      const productId = product.id;\n\n      const existing = await pb\n        .collection(\"cart\")\n        .getFirstListItem(\n          `user=\"${pb.authStore.model.id}\" && product=\"${productId}\"`\n        )\n        .catch(() => null);\n\n      if (existing) {\n        await pb.collection(\"cart\").update(existing.id, {\n          quantity: existing.quantity + quantity,\n        });\n      } else {\n        await pb.collection(\"cart\").create({\n          user: userId,\n          product: product.id,\n          quantity: quantity,\n        });\n      }\n\n      this.showToast(\"Added to cart!\");\n      window.dispatchEvent(\n        new CustomEvent(\"product-added-to-cart\", { detail: this })\n      );\n    } catch (err) {\n      console.error(\"Error adding to cart:\", err);\n      this.showToast(\"Failed to add to cart\");\n    }\n  }\n\n  addWhitelist() {\n    this.isWhitelisted = !this.isWhitelisted;\n    const btn = document.querySelector(\".white-list\");\n    if(this.isWhitelisted) {\n        btn.textContent = \"â™¥\";\n    } else {\n        btn.textContent = \"â™¡\";\n    }\n    btn.classList.toggle(\"active\", this.isWhitelisted);\n    this.showToast(\n      this.isWhitelisted ? \"Added to Whitelist\" : \"Removed from Whitelist\"\n    );\n  }\n\n  async getProduct() {\n    \n    const urlParams = new URLSearchParams(window.location.search);\n    const productId = urlParams.get(\"id\");\n\n    if(!productId)\n         {\n        console.error(\"Product ID not found in URL\");\n        return;\n        }\n\n        try{\n            const product = await pb.collection('products').getOne(productId);\n            const relatedRecords = await pb.collection('products').getList(1, 4, {\n                filter: `category = \"${product.category}\" && id != \"${productId}\"`,\n            });\n\n            const productData = product;\n            const relatedProducts = relatedRecords.items;\n            this.renderProduct(product, relatedProducts || []);\n            this.setupEventListeners(product, relatedProducts || []);\n        }\n        catch(err) {\n            console.error(\"Error fetching product:\", err);\n            this.showToast(\"Failed to fetch product\");\n        }\n  }\n\n  displayUserName() {\n\n    const user =  this.getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n    }\n  }\n\n  getCurrentUser() {\n    return pb.authStore.model;\n  }\n\n  logOut() {\n    pb.authStore.clear(); \n    window.location.href = 'index.html';\n  }\n\n  setupEventListeners(product, relatedProducts) {\n    const addToCartBtn = document.querySelector(\".btn-add-cart\");\n    const qtyInput = document.querySelector('.qty-input');\n\n    addToCartBtn.addEventListener(\"click\", () => {\n      const quantity = parseInt(qtyInput.value) || 1;\n      this.addToCart(product, quantity);\n    });\n\n    // for related products\n    const relProducts = document.querySelector('.related-products-grid');\n    relProducts.addEventListener('click', (e) => {\n        const btn = e.target.closest('.cart-btn');\n\n        if(btn) {\n            const id = btn.dataset.id;\n            const relatedProduct = relatedProducts.find(p => p.id === id);\n            if(relatedProduct) {\n                this.addToCart(relatedProduct, 1);\n            }\n        }\n    });\n\n    document.querySelectorAll('.qty-btn').forEach(btn => {\n        btn.addEventListener('click', () => {\n            let currentQty = parseInt(qtyInput.value) || 1;\n            if(btn.textContent === '+') {\n                currentQty += 1;\n            } else if(btn.textContent === '-' && currentQty > 1) {\n                currentQty -= 1;\n            }\n            qtyInput.value = currentQty;\n        })\n    })\n\n    const wishlistBtn = document.querySelector('.white-list');\n    wishlistBtn.addEventListener('click', () => {\n        this.addWhitelist(wishlistBtn);\n    })\n\n    const tabButtons = document.querySelectorAll('.tab-btn');\n    const tabPanes = document.querySelectorAll('.tab-pane');\n\n    tabButtons.forEach((btn, index) => {\n        btn.addEventListener('click', () => {\n            tabButtons.forEach(b => b.classList.remove('active'));\n            tabPanes.forEach(pane => pane.classList.remove('active'));\n\n            btn.classList.add('active');\n            tabPanes[index].classList.add('active');\n        })\n    })\n\n    function copyToClipboard(text) {\n        navigator.clipboard.writeText(text).then(() => {\n            this.showToast('Product link copied to clipboard!');\n        }).catch(err => {\n            console.error('Failed to copy: ', err);\n        });\n    }\n\n    const copy = document.querySelector('.copy')\n        copy.addEventListener('click', () => {\n            const url = 'http://127.0.0.1:5500/';\n            const textToCopy = `${url}product-detail.html?id=${product.id}`;\n            copyToClipboard(textToCopy);\n        });\n  }\n\n  renderProduct(product, relatedProducts) {\n        const main = document.querySelector(\".main-content\");\n        const getImgUrl = (item) => item.image ? pb.files.getURL(item, item.image) : '/assest/images/placeholder.png';\n\n\n        const relatedHtml = relatedProducts.length > 0 ?\n            relatedProducts.map(prod => {\n                return `\n                <a href=\"product-detail.html?id=${prod.id}\">\n                    <div class=\"product-card\"\">\n                        <div class=\"product-image-container\">\n                            <img src=${getImgUrl(prod)} alt=\"${prod.name}\">\n                            <div class=\"product-actions\">\n                                <button class=\"cart-btn\" data-id=\"${prod.id}>Add to Cart\n                                <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                                <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                                <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                                <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                                </svg>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"product-info\">\n                            <div class=\"product-category\">${prod.category}</div>\n                            <div class=\"product-name\">${prod.name}</div>\n                            <div class=\"product-rating\">\n                                <span class=\"rating-value\">${prod.rating}</span>\n                            </div>\n                            <div class=\"product-price\">\n                                <span class=\"current-price\">${prod.price}</span>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n                `}).join('') :\n            '<p>No related products found.</p>';\n\n        main.innerHTML = `\n            <div class=\"breadcrumb\">\n                <a href=\"dashboard.html\">Home</a>\n                <span>/</span>\n                <a href=\"products.html\">Products</a>\n                <span>/</span>\n                <span class=\"current\">${product.name}</span>\n            </div>\n\n            <div class=\"product-detail-layout\">\n                <div class=\"product-images\">\n                    <div class=\"main-image\">\n                        <img src=\"${getImgUrl(product)}\" alt=\"ProductName\">\n                    </div>\n                </div>\n\n                <div class=\"product-details\">\n                    <div class=\"product-header\">\n                        <div>\n                            <h1 class=\"product-title\">${product.name}</h1>\n                            <div class=\"product-rating-detail\">\n                                <div class=\"star\">${new ProductCard(product).generateStars()}</div>\n                                <span class=\"rating-text\">${product.rating}</span>\n                            </div>\n                        </div>\n                        <div class=\"product-actions-header\">\n                            <button class=\"icon-btn white-list\">â™¡</button>\n                            <button class=\"icon-btn\" copy>ðŸ”—</button>\n                        </div>\n                    </div>\n\n                    <div class=\"product-price-detail\">\n                        <span class=\"current-price\">${product.price}</span>\n                        <span class=\"original-price\">${product.originalPrice}</span>\n                        <span class=\"save-badge\">Save ${product.originalPrice - product.price}</span>\n                    </div>\n\n                    <p class=\"product-description\">${product.description} </p>\n\n\n                    <div class=\"product-purchase\">\n                        <div class=\"quantity-selector\">\n                            <button class=\"qty-btn\">-</button>\n                            <input type=\"number\" value=\"1\" min=\"1\" title=\"qty-btn\" class=\"qty-input\"/>\n                            <button class=\"qty-btn\">+</button>\n                        </div>\n                        <button class=\"btn-add-cart\">Add to Cart \n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                            <path d=\"M2 2H3.5L4.5 4M4.5 4L6.5 14H16.5L18.5 6H4.5Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n                            <circle cx=\"7\" cy=\"18\" r=\"1\" fill=\"currentColor\"/>\n                            <circle cx=\"16\" cy=\"18\" r=\"1\" fill=\"currentColor\"/></svg>\n                        </button>\n                    </div>\n\n                    <div class=\"product-info-section\">\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Stock:</span>\n                            <span class=\"info-value in-stock\">${product.quantity > 0 ? \"In Stock\" : \"Out of Stock\"}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Warranty:</span>\n                            <span class=\"info-value\">2 Years</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"product-tabs\">\n                <div class=\"tabs-header\">\n                    <button class=\"tab-btn active\">Reviews</button>\n                    <button class=\"tab-btn\">Shipping Info</button>\n                </div>\n                <div class=\"tabs-content\">\n                    <div id=\"reviews\" class=\"tab-pane active\">\n                        <div class=\"reviews-section\">\n                            <div class=\"reviews-summary\">\n                                <div class=\"overall-rating\">\n                                    <div class=\"rating-number\">${product.rating}</div>\n                                    <div class=\"rating-stars\">${new ProductCard(product).generateStars()}</div>\n                                    <div class=\"reviews-count\">Based on ${product.reviews} reviews</div>\n                                </div>\n                                <button class=\"write-review-btn btn\">Write Review</button>\n                            </div>\n                            <div class=\"review-item\">\n                                <div class=\"review-header\">\n                                    <strong></strong>\n                                    <span class=\"review-date\"></span>\n                                </div>\n                                <div class=\"review-rating\"></div>\n                                <p class=\"review-text\"></p>\n                            </div>\n                        </div>\n                    </div>\n                    <div id=\"shipping\" class=\"tab-pane\">\n                        <div class=\"shipping-info\">\n                            <h3>Free Shipping</h3>\n                            <p>Free delivery on orders over $50. Estimated delivery: 3-5 business days.</p>\n                            <h3>Returns</h3>\n                            <p>30-day return policy. Free returns for unwanted items in original condition.</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <section class=\"related-products\">\n                <h2 class=\"section-title\">You Might Also Like</h2>\n                <div class=\"related-products-grid\">\n                ${relatedHtml}\n            </div>\n            </section>\n        `;\n    }\n}\n\n const detail = new ProductDetail();\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    detail.getProduct();\n    detail.displayUserName();\n});\n\n// Event listeners \nconst home  = document.querySelector('.logo-text');\nhome.addEventListener('click', () => {\n    window.location.href = '/public/index.html';\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    detail.logOut();\n});\n\n"]}