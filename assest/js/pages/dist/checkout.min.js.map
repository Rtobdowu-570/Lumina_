{"version":3,"sources":["checkout.js"],"names":["_pocketbase","require","_modal","_cartItem","cartItem","CartItem","showPaymentModal","PaymentModal","message","confirmText","title","user","cartRecord","last","toTal","cartItemIds","data","modal","regeneratorRuntime","async","_context","prev","next","showToast","getCurrentUser","id","awrap","pb","collection","getFullList","filter","concat","sent","document","querySelector","console","log","map","record","items","successful","failed","total","create","classList","remove","stop","onCancel","setTimeout","Modal","querySelectorAll","completeBtn","validate","hasEmpty","inputs","some","i","value","trim","disabled","innerHTML","add","forEach","addEventListener","e","preventDefault","shippingRate","orderContent","first","second","third","subtotal","shipping","tax","_args2","arguments","_context2","length","undefined","pd","expand","product","price","quantity","itemTotal","productData","name","toFixed","textContent","checkAuth","isAuthenticated","href","userName","TAX_RATE","logOut","displayUsername","ValidateInput","getProductAddedToCart","logOutBtn","multiTabs","window","location","tab","tabType","contains","t","options","feeValue","option","dataset","fee","toLowerCase","user_name","o","authStore","goBack"],"mappings":"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","file":"checkout.min.js","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport {  Modal } from \"../components/modal.js\";\nimport { CartItem } from \"../components/cart-item.js\";\n\nconst cartItem = new CartItem();\n\nfunction showPaymentModal() {\n    const PaymentModal = {\n        title: \"Payment\",\n        message: \"Are you sure you want to proceed to payment?\",\n        confirmText: \"Confirm\",\n        cancelText: \"Cancel\",\n        onConfirm: async () => {\n            cartItem.showToast('Payment successful');\n            const user = getCurrentUser().id;\n            const cartRecord = await pb.collection('cart').getFullList({\n                filter: `user = \"${getCurrentUser().id}\"`\n            })\n\n            const last = document.querySelector('.last');\n            const toTal = last\n            console.log(toTal);\n\n            const cartItemIds = cartRecord.map(record => record.id);\n            const data = {\n            \"items\": cartItemIds,\n            \"user\": user,\n            \"successful\": true,\n            \"failed\": false,\n            \"total\": toTal\n        };\n        const checkoutRecord = await pb.collection('checkout').create(data);\n        cartItem.showToast(\"Payment Successful! Order Created.\");\n\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n        onCancel: () => {\n            cartItem.showToast('Payment failed');\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n    }\n    const modal = new Modal(PaymentModal);\n    modal.show();\n}\n\nfunction ValidateInput() {\n    const inputs = Array.from(document.querySelectorAll('input:not([type=\"hidden\"])'));\n    const completeBtn = document.querySelector('.complete');\n\n    if (!completeBtn) return;\n\n    function validate() {\n        const hasEmpty = inputs.some(i => !i.value || i.value.trim() === '');\n        \n        completeBtn.disabled = hasEmpty;\n\n        if (!hasEmpty) {\n            completeBtn.classList.add('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment âœ“';\n        } else {\n            completeBtn.classList.remove('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment'; \n        }\n\n        return hasEmpty;\n    }\n\n    inputs.forEach(i => i.addEventListener('input', validate));\n\n    validate();\n\n    completeBtn.addEventListener('click', (e) => {\n        e.preventDefault(); \n        showPaymentModal();\n    });\n}\n\nasync function getProductAddedToCart(shippingRate = 0.001) {\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    const orderContent = document.querySelector('.order-items');\n    const first = document.querySelector('.first');\n    const second = document.querySelector('.second');\n    const third = document.querySelector('.third');\n    const last = document.querySelector('.last');\n\n    let subtotal = 0;\n    let shipping = 0;\n    const TAX_RATE = 0.0005;\n\n    orderContent.innerHTML = '';\n    \n    data.forEach(pd => {\n        const productData = pd.expand.product;\n        const itemTotal = productData.price * pd.quantity;\n        subtotal += itemTotal;\n        shipping += productData.price * shippingRate * pd.quantity;\n\n        orderContent.innerHTML +=\n        `\n            <div class=\"order-item\">\n                <div class=\"item-info\">\n                    <span class=\"item-name\">${productData.name}</span>\n                    <span class=\"item-qty\">Qty: ${pd.quantity}</span>\n                </div>\n                <span class=\"item-price\">$${itemTotal.toFixed(2)}</span>\n            </div>\n        `\n    });\n\n    const tax = subtotal * TAX_RATE;\n    const total = subtotal + shipping + tax;\n\n    if (first) first.textContent = subtotal.toFixed(2);\n    if (second) second.textContent = shipping.toFixed(2);\n    if (third) third.textContent = tax.toFixed(2);\n    if (last) last.textContent = total.toFixed(2);\n}\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n    checkAuth();\n    displayUsername();\n    ValidateInput()\n    getProductAddedToCart()\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst multiTabs = document.querySelectorAll('.payment-option, .shipping-option');\nmultiTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n        const tabType = tab.classList.contains('payment-option') ? 'payment-option' : 'shipping-option';\n        document.querySelectorAll('.' + tabType).forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n    });\n});\n\nconst options = document.querySelectorAll('[data-fee]');\noptions.forEach(option => {\n    option.addEventListener('click', () => {\n        const feeValue = option.dataset.fee.toLowerCase();\n        document.querySelectorAll('[data-fee]').forEach(o => o.classList.remove('active'));\n        option.classList.add('active');\n        if(feeValue === 'standard') {\n           getProductAddedToCart(0.001);\n        } else if(feeValue === 'express') {\n            getProductAddedToCart(0.004);\n        } else if(feeValue === 'overnight') {\n            getProductAddedToCart(0.007);\n        }\n    })\n})\n\nconst goBack = document.querySelector('.return');\ngoBack.addEventListener('click', () => {\n    window.location.href = '/public/cart.html';\n})\n\n"]}