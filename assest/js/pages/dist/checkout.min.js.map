{"version":3,"sources":["checkout.js"],"names":["_pocketbase","require","_modal","_cartItem","cartItem","CartItem","showPaymentModal","PaymentModal","message","confirmText","title","user","cartRecord","cartItemIds","data","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","id","modal","regeneratorRuntime","async","_context","prev","next","showToast","getCurrentUser","awrap","pb","collection","getFullList","filter","concat","sent","map","record","items","successful","create","undefined","Symbol","iterator","done","value","t0","finish","document","querySelector","classList","remove","setTimeout","stop","onCancel","Modal","show","ValidateInput","inputs","Array","from","querySelectorAll","completeBtn","validate","hasEmpty","some","i","trim","disabled","innerHTML","add","forEach","addEventListener","e","preventDefault","getProductAddedToCart","shippingRate","orderContent","first","second","third","last","subtotal","shipping","tax","total","_args2","arguments","_context2","length","expand","pd","productData","product","price","quantity","itemTotal","name","toFixed","textContent","checkAuth","isAuthenticated","window","location","href","displayUsername","userName","user_name","logOut","authStore","logOutBtn","multiTabs","tab","tabType","contains","t","options","option","feeValue","dataset","fee","toLowerCase","o"],"mappings":"aAAA,IAAAA,YAAAC,QAAA,wBACAC,OAAAD,QAAA,0BADAE,UAAAF,QAAA,8BACAG,SAAA,IAAAC,UAAAA,SACA,SAAAC,mBAKI,IAAMC,EAAe,CAHnBH,MAAW,UAKTI,QAAS,+CAHjBC,YAASH,UACCC,WAAY,SACdG,UAAO,WAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OACAtB,SAAEuB,UAAA,sBACIhB,EAAAiB,iBAHIR,GACVI,EAAAE,KAAA,EAAAJ,mBAAAO,MADUC,YAAAA,GAAAC,WAAA,QAAAC,YAAA,CAKNC,OAAA,WAAAC,OAAAN,iBAAAR,GAAA,QAJJ,KAAA,EAAA,OAGKR,EAHLY,EAAAW,KAUGtB,EAAcD,EAAWwB,IAAI,SAAAC,GAAM,OAAIA,EAAOjB,KAN7CN,EAAA,CAAAwB,MAAAzB,EAAAF,KAAAA,EAAA4B,YAAA,EACPnC,QAAQ,GALLoB,EAAAE,KAAA,EAAAJ,mBAAAO,MAIIC,YAAAA,GAAAC,WAAA,YAAAS,OAAA1B,IAJJ,KAAA,EAAAU,EAAAW,KAAAnB,IAAAD,GAAA,GAAAE,OAAAwB,EAAAjB,EAAAC,KAAA,GAAAP,EAIIL,EAJJ6B,OAAAC,YAAA,KAAA,GAAA,GAAA5B,GAAAI,EAAAD,EAAAQ,QAAAkB,KAAA,CAAApB,EAAAE,KAAA,GAAA,MAAA,OAIIN,EAJJD,EAAA0B,MAAArB,EAAAE,KAAA,GAAAJ,mBAAAO,MAQCI,YAAAA,GAAAA,WAAM,QAANA,OAAmBL,IARpB,KAAA,GAAAb,GAAA,EAAAS,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAsB,GAAAtB,EAAA,MAAA,IAAAR,GAAA,EAAAC,EAAAO,EAAAsB,GAAA,KAAA,GAAAtB,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAV,GAAA,MAAAG,EAAA,QAAAA,EAAA,SAAA,KAAA,GAAA,GAAAM,EAAAC,KAAA,GAAAT,EAAA,MAAAC,EAAAO,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAA,OAAAF,EAAAuB,OAAA,IAAA,KAAA,GAAA,OAAAvB,EAAAuB,OAAA,IAAA,KAAA,GAqBP3C,SAASuB,UAAU,uCAdTf,EAHCoC,SAAAC,cAAA,aAMkC5B,EAAA6B,UAAAC,OAAA,QANlCC,WAAA,WAAA,OAAA/B,EAAA8B,UAAA,MAJJ,KAAA,GAAA,IAAA,MAAA,OAAA3B,EAAA6B,SAAA,KAAA,KAAA,CAAA,CAAA,GAAA,GAAA,GAAA,IAAA,CAAA,GAAA,CAAA,GAAA,OAaHC,SAAA,WACAlD,SAAAuB,UAAc,kBACd,IAAAN,EAAU2B,SAAAC,cAAA,UAXH5B,IAAAA,EAAA6B,UAAAC,OAAA,QAAAC,WAAA,WAAA,OAAA/B,EAAA8B,UAakBrB,QAblB,IAAAyB,OAAAA,MAAAhD,GAAAiD,OAAA,SAAAC,gBAuCf,IAAMC,EAASC,MAAMC,KAAKZ,SAASa,iBAAiB,+BAvCrCC,EAAAd,SAAAC,cAAA,aAAA,SAAAc,IA6CX,IAAMC,EAAWN,EAAOO,KAAK,SAAAC,GAAC,OAAKA,EAAErB,OAA4B,KAAnBqB,EAAErB,MAAMsB,SA7C3C,OAAAL,EAAAM,SAAAJ,IAAAF,EAAAZ,UAAAC,OAAA,eAsDPW,EAAYO,UAAY,qBAtDjBP,EAAAZ,UAAAoB,IAAA,eAAAR,EAAAO,UAAA,sBAAAL,EAAAF,IAAAJ,EAAAa,QAAA,SAAAL,GAAA,OAAAA,EAAAM,iBAAA,QAAAT,KAAAA,IAgEfD,EAAYU,iBAAiB,QAAS,SAACC,GAhExBA,EAAAC,iBAAApE,sBAAA,SAAAqE,wBAAA,IAAAC,EAAA9D,EAAA+D,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,UAAA,OAAAjE,mBAAAC,MAAA,SAAAiE,GAAA,OAAA,OAAAA,EAAA/D,KAAA+D,EAAA9D,MAAA,KAAA,EAAA,OAAAkD,EAAA,EAAAU,EAAAG,aAAAhD,IAAA6C,EAAA,GAAAA,EAAA,GAAA,KAAAE,EAAA9D,KAAA,EAAAJ,mBAAAO,MAAAC,YAAAA,GAAAC,WAAA,QAAAC,YAAA,CAwEXC,OAAM,WAAAC,OAAaN,iBAAiBR,GAA9B,KAxEKsE,OAAA,aAAA,KAAA,EAAA5E,EAAA0E,EAAArD,KAAA0C,EAAA7B,SAAAC,cAAA,gBAAA6B,EAAA9B,SAAAC,cAAA,UAAA8B,EAAA/B,SAAAC,cAAA,WAAA+B,EAAAhC,SAAAC,cAAA,UAgFTgC,EAAOjC,SAASC,cAAc,SAhFrBkC,EAkFXD,EAAW,EAlFA,KAAAL,EAAAR,UAAA,GAwFfvD,EAAKyD,QAAQ,SAAAoB,GAxFE,IAAAC,EAAAD,EAAAD,OAAAG,QAiBXzF,EAASuB,EAAUmE,MAAAH,EAAAI,SAET1E,GAnBC2E,EA4FXb,GAAYS,EAAYE,MAAQlB,EAAee,EAAGI,SAvE1C1E,EAAKgD,WAALhD,gIAAAA,OAEHuE,EAAAK,KAFG5E,6DAAAA,OA8EkCsE,EAAGI,SA9ErC1E,+EAAAA,OArBG2E,EAAAE,QAAA,GAqBH7E,2CAIRiC,EAAU4B,EAAAC,GA9BOC,EAKN,KALMF,GAgCbJ,IAAWA,EAAG9B,YAASC,EAAciD,QAArC,IAmFJnB,IAAQA,EAAOoB,YAAchB,EAASe,QAAQ,IAlF1ClB,IAAAA,EAAWmB,YAAAf,EAAAc,QAAA,IACP7E,IAAM6B,EAAAA,YAAiBmC,EAAvBa,QAAA,IA7BG,KAAA,GAAA,IAAA,MAAA,OAAAV,EAAAnC,UA8BQ,SAAD+C,aACb,EAAApG,YAAAqG,qBACJC,OAAAC,SAAAC,KAAA,0BAIR,SAAAC,kBAsFG,IAAM9F,EAAQiB,iBApFT6B,EAAAA,SAAgBR,cAAA,eAEfa,EAAAA,YAAAA,mBAEDA,EAAAA,KAqFD4C,EAASP,YAAcxF,EAAKsF,KAlFtBjC,EAAQmC,YAAexF,EAAAgG,UAwF/BD,EAASP,YAAc,QAjFpB,SAHDvE,iBAIIkC,OAAAA,YAAAA,GAAAA,UAAYZ,MAwFxB,SAAS0D,SApFD9E,YAAAA,GAAA+E,UAAO7C,QACVsC,OAAAC,SAAAC,KAAA,mBAEexD,SAAAwB,iBAAMA,mBAAF,WAApB4B,YAEArC,kBAEAD,gBACIW,0BAGP,IAAAqC,UAAA9D,SAAAC,cAAA,YAsFD6D,UAAUtC,iBAAiB,QAAS,WApFpCoC,WAAA,IAAAG,UAAA/D,SAAAa,iBAAA,qCAAAkD,UAAAxC,QAAA,SAAAyC,GAAAA,EAAAxC,iBAAA,QAAA,WAAA,IAAAyC,EAAAD,EAAA9D,UAAAgE,SAAA,kBAAA,iBAAA,kBAAAlE,SAAAa,iBAAA,IAAAoD,GAAA1C,QAAA,SAAA4C,GAAA,OAAAA,EAAAjE,UAAAC,OAAA,YAAA6D,EAAA9D,UAAAoB,IAAA,cAAA,IAAA8C,QAAApE,SAAAa,iBAAA,cAAAuD,QAAA7C,QAAA,SAAA8C,GAAAA,EAAA7C,iBAAA,QAAA,WAAA,IAAA8C,EAAAD,EAAAE,QAAAC,IAAAC,cAAAzE,SAAAa,iBAAA,cAAAU,QAAA,SAAAmD,GAAA,OAAAA,EAAAxE,UAAAC,OAAA,YAAAkE,EAAAnE,UAAAoB,IAAA,UAAA,aAAqCM,EAArCD,sBAAA,MAAA,YAAA2C,EAEQrF,sBAAM,MACE,cAAFqF,GAHd3C,sBAAA,UAOUG,IAAAA,OAPV9B,SAOkBA,cAASC,WACjB8B,OAAAA,iBAAS/B,QAASC,WAClB+B,OAAAA,SAAQhC,KAASC","file":"checkout.min.js","sourcesContent":["import { pb, isAuthenticated } from '../api/pocketbase.js';\nimport {  Modal } from \"../components/modal.js\";\nimport { CartItem } from \"../components/cart-item.js\";\n\nconst cartItem = new CartItem();\n\nfunction showPaymentModal() {\n    const PaymentModal = {\n        title: \"Payment\",\n        message: \"Are you sure you want to proceed to payment?\",\n        confirmText: \"Confirm\",\n        cancelText: \"Cancel\",\n        onConfirm: async () => {\n            cartItem.showToast('Payment successful');\n            const user = getCurrentUser().id;\n            const cartRecord = await pb.collection('cart').getFullList({\n                filter: `user = \"${getCurrentUser().id}\"`\n            })\n            const cartItemIds = cartRecord.map(record => record.id);\n            const data = {\n            \"items\": cartItemIds,\n            \"user\": user,\n            \"successful\": true,\n            \"failed\": false\n        };\n        const checkoutRecord = await pb.collection('checkout').create(data);\n        for (let id of cartItemIds) {\n            await pb.collection('cart').delete(id);\n        }\n        cartItem.showToast(\"Payment Successful! Order Created.\");\n\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n        onCancel: () => {\n            cartItem.showToast('Payment failed');\n            const modal = document.querySelector(\".modal\");\n            if (modal) {\n                modal.classList.remove(\"show\");\n                setTimeout(() => modal.remove(), 300);\n            }\n        },\n    }\n    const modal = new Modal(PaymentModal);\n    modal.show();\n}\n\nfunction ValidateInput() {\n    const inputs = Array.from(document.querySelectorAll('input:not([type=\"hidden\"])'));\n    const completeBtn = document.querySelector('.complete');\n\n    if (!completeBtn) return;\n\n    function validate() {\n        const hasEmpty = inputs.some(i => !i.value || i.value.trim() === '');\n        \n        completeBtn.disabled = hasEmpty;\n\n        if (!hasEmpty) {\n            completeBtn.classList.add('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment âœ“';\n        } else {\n            completeBtn.classList.remove('ready-pulse');\n            completeBtn.innerHTML = 'Complete Payment'; \n        }\n\n        return hasEmpty;\n    }\n\n    inputs.forEach(i => i.addEventListener('input', validate));\n\n    validate();\n\n    completeBtn.addEventListener('click', (e) => {\n        e.preventDefault(); \n        showPaymentModal();\n    });\n}\n\nasync function getProductAddedToCart(shippingRate = 0.001) {\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    const orderContent = document.querySelector('.order-items');\n    const first = document.querySelector('.first');\n    const second = document.querySelector('.second');\n    const third = document.querySelector('.third');\n    const last = document.querySelector('.last');\n\n    let subtotal = 0;\n    let shipping = 0;\n    const TAX_RATE = 0.0005;\n\n    orderContent.innerHTML = '';\n    \n    data.forEach(pd => {\n        const productData = pd.expand.product;\n        const itemTotal = productData.price * pd.quantity;\n        subtotal += itemTotal;\n        shipping += productData.price * shippingRate * pd.quantity;\n\n        orderContent.innerHTML +=\n        `\n            <div class=\"order-item\">\n                <div class=\"item-info\">\n                    <span class=\"item-name\">${productData.name}</span>\n                    <span class=\"item-qty\">Qty: ${pd.quantity}</span>\n                </div>\n                <span class=\"item-price\">$${itemTotal.toFixed(2)}</span>\n            </div>\n        `\n    });\n\n    const tax = subtotal * TAX_RATE;\n    const total = subtotal + shipping + tax;\n\n    if (first) first.textContent = subtotal.toFixed(2);\n    if (second) second.textContent = shipping.toFixed(2);\n    if (third) third.textContent = tax.toFixed(2);\n    if (last) last.textContent = total.toFixed(2);\n}\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n    checkAuth();\n    displayUsername();\n    ValidateInput()\n    getProductAddedToCart()\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst multiTabs = document.querySelectorAll('.payment-option, .shipping-option');\nmultiTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n        const tabType = tab.classList.contains('payment-option') ? 'payment-option' : 'shipping-option';\n        document.querySelectorAll('.' + tabType).forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n    });\n});\n\nconst options = document.querySelectorAll('[data-fee]');\noptions.forEach(option => {\n    option.addEventListener('click', () => {\n        const feeValue = option.dataset.fee.toLowerCase();\n        document.querySelectorAll('[data-fee]').forEach(o => o.classList.remove('active'));\n        option.classList.add('active');\n        if(feeValue === 'standard') {\n           getProductAddedToCart(0.001);\n        } else if(feeValue === 'express') {\n            getProductAddedToCart(0.004);\n        } else if(feeValue === 'overnight') {\n            getProductAddedToCart(0.007);\n        }\n    })\n})\n\nconst goBack = document.querySelector('.return');\ngoBack.addEventListener('click', () => {\n    window.location.href = '/public/cart.html';\n})\n\n"]}