"use strict";var _cartItem=require("../components/cart-item.js"),_pocketbase=require("../api/pocketbase.js"),cartItem=new _cartItem.CartItem;function displayCart(){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(t=getCurrentUser())&&t.id){e.next=5;break}return console.warn("No authenticated user"),e.abrupt("return");case 5:return e.next=7,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:"user = '".concat(t.id,"'"),expand:"product"}));case 7:if(n=e.sent,a=document.querySelector(".cart-items")){e.next=12;break}return console.warn("Cart container not found"),e.abrupt("return");case 12:n.forEach(function(e){var t=e.expand.product,n=document.createElement("div");return n.className="cart-item",n.dataset.id=e.id,n.innerHTML+='\n            <div class="item-image"><img src="'.concat(_pocketbase.pb.files.getURL(t,t.image),'" alt="').concat(t.name,'"></div>\n            <div class="item-details">\n                <h3 class="item-name">').concat(t.name,'</h3>\n            </div>\n        <div class="item-quantity">\n            <button class="qty-btn" data-action="decrease">‚àí</button>\n            <input type="number" value="').concat(e.quantity,'" min="1" data-action="quantity">\n            <button class="qty-btn" data-action="increase">+</button>\n        </div>\n        <div class="item-price">\n            <div class="price-current">$').concat(t.price.toFixed(2),"</div>\n            ").concat(t.originalPrice?'<div class="price-original">$'.concat(t.originalPrice.toFixed(2),"</div>"):"",'\n        </div>\n         <div class="item-actions">\n            <button class="remove-btn" data-action="remove">üóëÔ∏è</button>\n        </div>\n            '),a.appendChild(n),attachEventListeners(n),n}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Failed to display cart:",e.t0);case 18:case"end":return e.stop()}},null,null,[[0,15]])}function attachEventListeners(r){r.addEventListener("click",function(t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.closest("button"),"decrease"===(a=n?n.dataset.action:null))return e.next=5,regeneratorRuntime.awrap(updateQuantity(r,a));e.next=7;break;case 5:e.next=13;break;case 7:if("increase"===a)return e.next=10,regeneratorRuntime.awrap(updateQuantity(r,a));e.next=12;break;case 10:e.next=13;break;case 12:"remove"===a&&cartItem.remove(r);case 13:case"end":return e.stop()}})})}function updateQuantity(t,n){var a,r,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.querySelector('[data-action="quantity"]'),r=a.value,c=parseInt(r),"increase"===n)return a.value=c+1,e.next=7,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(t.dataset.id,{quantity:c+1}));e.next=9;break;case 7:e.next=13;break;case 9:if("decrease"===n)return a.value=c-1,e.next=13,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(t.dataset.id,{quantity:c-1}));e.next=13;break;case 13:case"end":return e.stop()}})}function calculateItemPrice(){var t,n,a,r,c,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector(".summary-details"),e.next=3,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"'),expand:"product"}));case 3:n=e.sent,console.log(n),a=0,n.forEach(function(e){var t=e.expand.product;a+=e.quantity*t.price}),i=a+(r=.01*a)+(c=.05*a*.05),t.innerHTML='\n        <div class="summary-row">\n            <span>Subtotal (<span id="total-items">'.concat(n.length,"</span> ").concat(1<n.length?"items":"item",')</span>\n            <span id="subtotal">$').concat(a.toFixed(2),'</span>\n        </div>\n        <div class="summary-row">\n            <span>Shipping</span>\n            <span id="shipping">$').concat(r.toFixed(2),'</span>\n        </div>\n        <div class="summary-row">\n            <span>Tax</span>\n            <span id="tax">$').concat(c.toFixed(2),'</span>\n        </div>\n        <div class="summary-row discount" id="discount-row" style="display: none">\n            <span>Discount</span>\n            <span id="discount">-$0.00</span>\n        </div>\n        <div class="summary-divider"></div>\n        <div class="summary-row total">\n            <span>Total</span>\n            <span id="total">$').concat(i.toFixed(2),"</span>\n        </div>\n    ");case 11:case"end":return e.stop()}})}function checkAuth(){(0,_pocketbase.isAuthenticated)()||(window.location.href="/public/auth/auth.html")}function displayUsername(){var e=getCurrentUser(),t=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?e.name?t.textContent=e.name:t.textContent=e.user_name:t.textContent="Guest"}function getCurrentUser(){return _pocketbase.pb.authStore.model}function logOut(){_pocketbase.pb.authStore.clear(),window.location.href="/auth/login.html"}document.addEventListener("DOMContentLoaded",function(){displayCart(),checkAuth(),displayUsername(),calculateItemPrice()});var logOutBtn=document.querySelector(".log-out");logOutBtn.addEventListener("click",function(){logOut()});
//# sourceMappingURL=cart.min.js.map
