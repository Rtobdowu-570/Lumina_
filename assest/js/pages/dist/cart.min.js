"use strict";var _cartItem=require("../components/cart-item.js"),_pocketbase=require("../api/pocketbase.js"),cartItem=new _cartItem.CartItem;function displayCart(){var t,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(t=getCurrentUser())&&t.id){e.next=5;break}return console.warn("No authenticated user"),e.abrupt("return");case 5:return e.next=7,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:"user = '".concat(t.id,"'"),expand:"product"}));case 7:if(a=e.sent,n=document.querySelector(".cart-items")){e.next=12;break}return console.warn("Cart container not found"),e.abrupt("return");case 12:a.forEach(function(e){var t=e.expand.product;console.log(t);var a=document.createElement("div");return a.className="cart-item",a.dataset.id=e.id,a.innerHTML+='\n            <div class="item-image"><img src="'.concat(_pocketbase.pb.files.getURL(t,t.image),'" alt="').concat(t.name,'"></div>\n            <div class="item-details">\n                <h3 class="item-name">').concat(t.name,'</h3>\n            </div>\n        <div class="item-quantity">\n            <button class="qty-btn" data-action="decrease">‚àí</button>\n            <input type="number" value="').concat(e.quantity,'" min="1" data-action="quantity">\n            <button class="qty-btn" data-action="increase">+</button>\n        </div>\n        <div class="item-price">\n            <div class="price-current">$').concat(t.price.toFixed(2),"</div>\n            ").concat(t.originalPrice?'<div class="price-original">$'.concat(t.originalPrice.toFixed(2),"</div>"):"",'\n        </div>\n         <div class="item-actions">\n            <button class="remove-btn" data-action="remove">üóëÔ∏è</button>\n        </div>\n            '),n.appendChild(a),attachEventListeners(a),a}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Failed to display cart:",e.t0);case 18:case"end":return e.stop()}},null,null,[[0,15]])}function checkAuth(){(0,_pocketbase.isAuthenticated)()||(window.location.href="/public/auth/auth.html")}function attachEventListeners(e){e.addEventListener("click",function(t){var a,n,r,c,i,u,s,o,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.closest("[data-action]")){e.next=3;break}return e.abrupt("return");case 3:n=a.dataset.action,r=a,c=null;case 6:if(!r){e.next=13;break}if(r.dataset&&r.dataset.id)return c=r,e.abrupt("break",13);e.next=10;break;case 10:r=r.previousElementSibling||r.parentElement,e.next=6;break;case 13:if(c){e.next=15;break}return e.abrupt("return");case 15:if(i=c.dataset.id,"increase"===n)return e.next=19,regeneratorRuntime.awrap(updateQuantity(1,i));e.next=21;break;case 19:e.next=49;break;case 21:if("decrease"===n)return e.next=24,regeneratorRuntime.awrap(updateQuantity(-1,i));e.next=26;break;case 24:e.next=49;break;case 26:if("remove"===n)return e.prev=27,e.next=30,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").delete(i));e.next=49;break;case 30:if(!(u=document.querySelector('[data-id="'.concat(i,'"]')))){e.next=43;break}s=u,o=0;case 34:if(!(o<4)){e.next=43;break}if(d=s.nextElementSibling,s.remove(),d){e.next=39;break}return e.abrupt("break",43);case 39:s=d;case 40:o++,e.next=34;break;case 43:window.dispatchEvent(new CustomEvent("cart-updated")),e.next=49;break;case 46:e.prev=46,e.t0=e.catch(27),console.error("Failed to remove cart item:",e.t0);case 49:case"end":return e.stop()}},null,null,[[27,46]])}),e.addEventListener("change",function(t){var a,n,r,c,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.closest('input[data-action="quantity"]')){e.next=3;break}return e.abrupt("return");case 3:n=Number.parseInt(a.value)||1,r=a,c=null;case 6:if(!r){e.next=13;break}if(r.dataset&&r.dataset.id)return c=r,e.abrupt("break",13);e.next=10;break;case 10:r=r.previousElementSibling||r.parentElement,e.next=6;break;case 13:if(c){e.next=15;break}return e.abrupt("return");case 15:return i=c.dataset.id,e.prev=16,e.next=19,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(i,{quantity:Math.max(1,n)}));case 19:window.dispatchEvent(new CustomEvent("cart-updated")),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(16),console.error("Failed to update quantity:",e.t0);case 25:case"end":return e.stop()}},null,null,[[16,22]])})}function updateQuantity(t,a){var n,r,c,i,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=document.querySelector('[data-id="'.concat(a,'"]'))){e.next=4;break}return e.abrupt("return");case 4:r=n.nextElementSibling,c=null;case 6:if(!r){e.next=13;break}if(c=r.querySelector&&r.querySelector('input[data-action="quantity"]'))return e.abrupt("break",13);e.next=10;break;case 10:r=r.nextElementSibling,e.next=6;break;case 13:if(c){e.next=15;break}return e.abrupt("return");case 15:return i=Number.parseInt(c.value)||1,u=Math.max(1,i+t),c.value=u,e.next=20,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").update(a,{quantity:u}));case 20:window.dispatchEvent(new CustomEvent("cart-updated")),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Failed to update quantity:",e.t0);case 26:case"end":return e.stop()}},null,null,[[0,23]])}function displayUsername(){var e=getCurrentUser(),t=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?e.name?t.textContent=e.name:t.textContent=e.user_name:t.textContent="Guest"}function getCurrentUser(){return _pocketbase.pb.authStore.model}function logOut(){_pocketbase.pb.authStore.clear(),window.location.href="/auth/login.html"}document.addEventListener("DOMContentLoaded",function(){displayCart(),checkAuth(),displayUsername()});
//# sourceMappingURL=cart.min.js.map
