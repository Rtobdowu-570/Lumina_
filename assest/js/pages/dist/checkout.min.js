"use strict";var _pocketbase=require("../api/pocketbase.js"),_modal=require("../components/modal.js"),_cartItem=require("../components/cart-item.js"),cartItem=new _cartItem.CartItem;function showPaymentModal(){var e={title:"Payment",message:"Are you sure you want to proceed to payment?",confirmText:"Confirm",cancelText:"Cancel",onConfirm:function(){var t,n,r,o,a,c,i,s,u,d,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return cartItem.showToast("Payment successful"),t=getCurrentUser().id,e.next=4,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"')}));case 4:return n=e.sent,r=n.map(function(e){return e.id}),o={items:r,user:t,successful:!0,failed:!1},e.next=9,regeneratorRuntime.awrap(_pocketbase.pb.collection("checkout").create(o));case 9:e.sent,c=!(a=!0),i=void 0,e.prev=13,s=r[Symbol.iterator]();case 15:if(a=(u=s.next()).done){e.next=22;break}return d=u.value,e.next=19,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").delete(d));case 19:a=!0,e.next=15;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(13),c=!0,i=e.t0;case 28:e.prev=28,e.prev=29,a||null==s.return||s.return();case 31:if(e.prev=31,c)throw i;e.next=34;break;case 34:return e.finish(31);case 35:return e.finish(28);case 36:cartItem.showToast("Payment Successful! Order Created."),(l=document.querySelector(".modal"))&&(l.classList.remove("show"),setTimeout(function(){return l.remove()},300));case 39:case"end":return e.stop()}},null,null,[[13,24,28,36],[29,,31,35]])},onCancel:function(){cartItem.showToast("Payment failed");var e=document.querySelector(".modal");e&&(e.classList.remove("show"),setTimeout(function(){return e.remove()},300))}};new _modal.Modal(e).show()}function ValidateInput(){var t=Array.from(document.querySelectorAll('input:not([type="hidden"])')),n=document.querySelector(".complete");function r(){var e=t.some(function(e){return!e.value||""===e.value.trim()});return(n.disabled=e)?(n.classList.remove("ready-pulse"),n.innerHTML="Complete Payment"):(n.classList.add("ready-pulse"),n.innerHTML="Complete Payment âœ“"),e}n&&(t.forEach(function(e){return e.addEventListener("input",r)}),r(),n.addEventListener("click",function(e){e.preventDefault(),showPaymentModal()}))}function getProductAddedToCart(){var r,t,o,n,a,c,i,s,u,d,l,m=arguments;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0<m.length&&void 0!==m[0]?m[0]:.001,e.next=3,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"'),expand:"product"}));case 3:t=e.sent,o=document.querySelector(".order-items"),n=document.querySelector(".first"),a=document.querySelector(".second"),c=document.querySelector(".third"),i=document.querySelector(".last"),u=s=0,5e-4,o.innerHTML="",t.forEach(function(e){var t=e.expand.product,n=t.price*e.quantity;s+=n,u+=t.price*r*e.quantity,o.innerHTML+='\n            <div class="order-item">\n                <div class="item-info">\n                    <span class="item-name">'.concat(t.name,'</span>\n                    <span class="item-qty">Qty: ').concat(e.quantity,'</span>\n                </div>\n                <span class="item-price">$').concat(n.toFixed(2),"</span>\n            </div>\n        ")}),l=s+u+(d=5e-4*s),n&&(n.textContent=s.toFixed(2)),a&&(a.textContent=u.toFixed(2)),c&&(c.textContent=d.toFixed(2)),i&&(i.textContent=l.toFixed(2));case 20:case"end":return e.stop()}})}function checkAuth(){(0,_pocketbase.isAuthenticated)()||(window.location.href="/public/auth/auth.html")}function displayUsername(){var e=getCurrentUser(),t=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?e.name?t.textContent=e.name:t.textContent=e.user_name:t.textContent="Guest"}function getCurrentUser(){return _pocketbase.pb.authStore.model}function logOut(){_pocketbase.pb.authStore.clear(),window.location.href="/auth/login.html"}document.addEventListener("DOMContentLoaded",function(){checkAuth(),displayUsername(),ValidateInput(),getProductAddedToCart()});var logOutBtn=document.querySelector(".log-out");logOutBtn.addEventListener("click",function(){logOut()});var multiTabs=document.querySelectorAll(".payment-option, .shipping-option");multiTabs.forEach(function(t){t.addEventListener("click",function(){var e=t.classList.contains("payment-option")?"payment-option":"shipping-option";document.querySelectorAll("."+e).forEach(function(e){return e.classList.remove("active")}),t.classList.add("active")})});var options=document.querySelectorAll("[data-fee]");options.forEach(function(t){t.addEventListener("click",function(){var e=t.dataset.fee.toLowerCase();document.querySelectorAll("[data-fee]").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"),"standard"===e?getProductAddedToCart(.001):"express"===e?getProductAddedToCart(.004):"overnight"===e&&getProductAddedToCart(.007)})});var goBack=document.querySelector(".return");goBack.addEventListener("click",function(){window.location.href="/public/cart.html"});
//# sourceMappingURL=checkout.min.js.map
