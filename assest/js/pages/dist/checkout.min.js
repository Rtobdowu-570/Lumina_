"use strict";var _pocketbase=require("../api/pocketbase.js"),_modal=require("../components/modal.js"),_cartItem=require("../components/cart-item.js"),cartItem=new _cartItem.CartItem;function showPaymentModal(){var e={title:"Payment",message:"Are you sure you want to proceed to payment?",confirmText:"Confirm",cancelText:"Cancel",onConfirm:function(){var t,n,o,r,a,c,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return cartItem.showToast("Payment successful"),t=getCurrentUser().id,e.next=4,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"')}));case 4:return n=e.sent,o=document.querySelector(".last"),r=o,console.log(r),a=n.map(function(e){return e.id}),c={items:a,user:t,successful:!0,failed:!1,total:r},e.next=12,regeneratorRuntime.awrap(_pocketbase.pb.collection("checkout").create(c));case 12:e.sent,cartItem.showToast("Payment Successful! Order Created."),(i=document.querySelector(".modal"))&&(i.classList.remove("show"),setTimeout(function(){return i.remove()},300));case 16:case"end":return e.stop()}})},onCancel:function(){cartItem.showToast("Payment failed");var e=document.querySelector(".modal");e&&(e.classList.remove("show"),setTimeout(function(){return e.remove()},300))}};new _modal.Modal(e).show()}function ValidateInput(){var t=Array.from(document.querySelectorAll('input:not([type="hidden"])')),n=document.querySelector(".complete");function o(){var e=t.some(function(e){return!e.value||""===e.value.trim()});return(n.disabled=e)?(n.classList.remove("ready-pulse"),n.innerHTML="Complete Payment"):(n.classList.add("ready-pulse"),n.innerHTML="Complete Payment âœ“"),e}n&&(t.forEach(function(e){return e.addEventListener("input",o)}),o(),n.addEventListener("click",function(e){e.preventDefault(),showPaymentModal()}))}function getProductAddedToCart(){var o,t,r,n,a,c,i,u,s,d,l,m=arguments;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=0<m.length&&void 0!==m[0]?m[0]:.001,e.next=3,regeneratorRuntime.awrap(_pocketbase.pb.collection("cart").getFullList({filter:'user = "'.concat(getCurrentUser().id,'"'),expand:"product"}));case 3:t=e.sent,r=document.querySelector(".order-items"),n=document.querySelector(".first"),a=document.querySelector(".second"),c=document.querySelector(".third"),i=document.querySelector(".last"),s=u=0,5e-4,r.innerHTML="",t.forEach(function(e){var t=e.expand.product,n=t.price*e.quantity;u+=n,s+=t.price*o*e.quantity,r.innerHTML+='\n            <div class="order-item">\n                <div class="item-info">\n                    <span class="item-name">'.concat(t.name,'</span>\n                    <span class="item-qty">Qty: ').concat(e.quantity,'</span>\n                </div>\n                <span class="item-price">$').concat(n.toFixed(2),"</span>\n            </div>\n        ")}),l=u+s+(d=5e-4*u),n&&(n.textContent=u.toFixed(2)),a&&(a.textContent=s.toFixed(2)),c&&(c.textContent=d.toFixed(2)),i&&(i.textContent=l.toFixed(2));case 20:case"end":return e.stop()}})}function checkAuth(){(0,_pocketbase.isAuthenticated)()||(window.location.href="/public/auth/auth.html")}function displayUsername(){var e=getCurrentUser(),t=document.querySelector(".user-name");(0,_pocketbase.isAuthenticated)()?e.name?t.textContent=e.name:t.textContent=e.user_name:t.textContent="Guest"}function getCurrentUser(){return _pocketbase.pb.authStore.model}function logOut(){_pocketbase.pb.authStore.clear(),window.location.href="/auth/login.html"}document.addEventListener("DOMContentLoaded",function(){checkAuth(),displayUsername(),ValidateInput(),getProductAddedToCart()});var logOutBtn=document.querySelector(".log-out");logOutBtn.addEventListener("click",function(){logOut()});var multiTabs=document.querySelectorAll(".payment-option, .shipping-option");multiTabs.forEach(function(t){t.addEventListener("click",function(){var e=t.classList.contains("payment-option")?"payment-option":"shipping-option";document.querySelectorAll("."+e).forEach(function(e){return e.classList.remove("active")}),t.classList.add("active")})});var options=document.querySelectorAll("[data-fee]");options.forEach(function(t){t.addEventListener("click",function(){var e=t.dataset.fee.toLowerCase();document.querySelectorAll("[data-fee]").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"),"standard"===e?getProductAddedToCart(.001):"express"===e?getProductAddedToCart(.004):"overnight"===e&&getProductAddedToCart(.007)})});var goBack=document.querySelector(".return");goBack.addEventListener("click",function(){window.location.href="/public/cart.html"});
//# sourceMappingURL=checkout.min.js.map
