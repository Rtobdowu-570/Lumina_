{"version":3,"sources":["cart.js"],"names":["_cartItem","require","_pocketbase","cartItem","CartItem","searchCart","query","cartItems","document","querySelectorAll","lowerQuery","toLowerCase","forEach","item","name","includes","querySelector","lowerItemName","display","displayCart","user","data","cartContainer","regeneratorRuntime","async","_context","prev","next","getCurrentUser","id","console","warn","abrupt","awrap","pb","collection","getFullList","filter","concat","expand","sent","pd","product","cartSection","createElement","className","dataset","innerHTML","files","getURL","productData","image","quantity","price","toFixed","originalPrice","attachEventListeners","t0","error","stop","addEventListener","e","btn","action","_context2","target","closest","updateQuantity","remove","input","currentQuantity","_context3","value","update","calculateItemPrice","paymentSummary","subtotal","shipping","tax","total","_context4","paymentData","length","checkAuth","window","location","href","displayUsername","userName","isAuthenticated","textContent","authStore","model","logOut","clear","logOutBtn","search"],"mappings":"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","file":"cart.min.js","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\n\nfunction searchCart(query) {\n    const cartItems = document.querySelectorAll('.cart-item');\n    const lowerQuery = query.toLowerCase();\n\n    cartItems.forEach(item => {\n        const name = item.querySelector('.item-name')\n        if(!name) return;\n\n        let itemName = name.textContent\n        const lowerItemName = itemName.toLowerCase();\n        if(lowerItemName.includes(lowerQuery)) {\n            item.style.display = 'flex';\n        }\n        else {\n            item.style.display = 'none';\n        }\n    })\n}\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${pd.quantity}\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\n\n function attachEventListeners(item) {\n    item.addEventListener('click', async (e) => {\n        const btn = e.target.closest('button');\n        const action = btn ? btn.dataset.action : null;\n        if (action === \"decrease\") {\n            await updateQuantity(item, action)\n        } else if (action === \"increase\") {\n            await updateQuantity(item, action)\n        } else if (action === \"remove\") {\n            cartItem.remove(item);\n        }\n    })\n}\n\nasync function updateQuantity(item, action) {\n    const input = item.querySelector('[data-action=\"quantity\"]');\n    const quantity = input.value;\n    const currentQuantity = parseInt(quantity);\n\n    if(action === \"increase\") {\n        input.value = currentQuantity + 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity + 1\n        })\n    } else if(action === \"decrease\") {\n        input.value = currentQuantity - 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity - 1\n        })\n    }\n}\n\nasync function calculateItemPrice() {\n    const paymentSummary = document.querySelector('.summary-details');\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    let subtotal = 0;\n    data.forEach(pd => {\n        const paymentData = pd.expand.product;\n        subtotal += pd.quantity * paymentData.price;\n    });\n\n    const shipping = subtotal * 0.01;\n    const tax = (subtotal * 0.01) * 0.05;\n    const total = subtotal + shipping + tax;\n\n    paymentSummary.innerHTML = \n    `\n        <div class=\"summary-row\">\n            <span>Subtotal (<span id=\"total-items\">${data.length}</span> ${data.length > 1 ? 'items' : 'item'})</span>\n            <span id=\"subtotal\">$${subtotal.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Shipping</span>\n            <span id=\"shipping\">$${shipping.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Tax</span>\n            <span id=\"tax\">$${tax.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row discount\" id=\"discount-row\" style=\"display: none\">\n            <span>Discount</span>\n            <span id=\"discount\">-$0.00</span>\n        </div>\n        <div class=\"summary-divider\"></div>\n        <div class=\"summary-row total\">\n            <span>Total</span>\n            <span id=\"total\">$${total.toFixed(2)}</span>\n        </div>\n    `\n}\n\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n    calculateItemPrice();\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst checkOut = document.querySelector('.checkout-btn');\ncheckOut.addEventListener('click', () => {\n    window.location.href = '/public/checkout.html';\n});\n\nconst continueShopping = document.querySelector('.continue-shopping-btn');\ncontinueShopping.addEventListener('click', () => {\n    window.location.href = '/public/products.html';\n});\n\nconst search = document.querySelector('.search-input')\nsearch.addEventListener('input', () => {\n    const searchItem = search.value;\n    searchCart(searchItem);\n});\n\nexport { calculateItemPrice }"]}