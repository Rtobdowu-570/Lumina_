{"version":3,"sources":["cart.js"],"names":["_cartItem","require","_pocketbase","cartItem","CartItem","displayCart","user","data","cartContainer","regeneratorRuntime","async","_context","prev","next","getCurrentUser","id","console","warn","abrupt","awrap","pb","collection","getFullList","filter","concat","sent","document","querySelector","forEach","pd","productData","expand","product","log","cartSection","createElement","className","dataset","innerHTML","files","getURL","image","name","quantity","price","toFixed","originalPrice","appendChild","attachEventListeners","t0","error","stop","checkAuth","isAuthenticated","window","location","href","container","addEventListener","e","btn","action","el","itemEl","row","toRemove","i","_context2","closest","previousElementSibling","parentElement","updateQuantity","nextElementSibling","remove","dispatchEvent","CustomEvent","input","target","newQuantity","Number","parseInt","value","update","Math","max","_context3","change","sibling","current","newQty","_context4","userName","textContent","user_name","logOut","authStore","clear","displayUsername"],"mappings":"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","file":"cart.min.js","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            console.log(productData)\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${\n              pd.quantity\n            }\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction attachEventListeners(container) {\n    container.addEventListener('click', async (e) => {\n      const btn = e.target.closest('[data-action]');\n      if (!btn) return;\n      const action = btn.dataset.action;\n\n      let el = btn;\n      let itemEl = null;\n      while (el) {\n        if (el.dataset && el.dataset.id) {\n          itemEl = el;\n          break;\n        }\n        el = el.previousElementSibling || el.parentElement;\n      }\n      if (!itemEl) return;\n      const id = itemEl.dataset.id;\n\n      if (action === 'increase') {\n        await updateQuantity(1, id);\n      } else if (action === 'decrease') {\n        await updateQuantity(-1, id);\n      } else if (action === 'remove') {\n        try {\n          await pb.collection('cart').delete(id);\n          const row = document.querySelector(`[data-id=\"${id}\"]`);\n          if (row) {\n            let toRemove = row;\n            for (let i = 0; i < 4; i++) {\n              const next = toRemove.nextElementSibling;\n              toRemove.remove();\n              if (!next) break;\n              toRemove = next;\n            }\n          }\n          window.dispatchEvent(new CustomEvent('cart-updated'));\n        } catch (err) {\n          console.error('Failed to remove cart item:', err);\n        }\n      }\n    });\n\n    container.addEventListener('change', async (e) => {\n      const input = e.target.closest('input[data-action=\"quantity\"]');\n      if (!input) return;\n      const newQuantity = Number.parseInt(input.value) || 1;\n\n      let el = input;\n      let itemEl = null;\n      while (el) {\n        if (el.dataset && el.dataset.id) {\n          itemEl = el;\n          break;\n        }\n        el = el.previousElementSibling || el.parentElement;\n      }\n      if (!itemEl) return;\n      const id = itemEl.dataset.id;\n\n      try {\n        await pb.collection('cart').update(id, { quantity: Math.max(1, newQuantity) });\n        window.dispatchEvent(new CustomEvent('cart-updated'));\n      } catch (err) {\n        console.error('Failed to update quantity:', err);\n      }\n    });\n  }\n\nasync function updateQuantity(change, id) {\n      try {\n        const itemEl = document.querySelector(`[data-id=\"${id}\"]`);\n        if (!itemEl) return;\n\n        let sibling = itemEl.nextElementSibling;\n        let input = null;\n        while (sibling) {\n          input = sibling.querySelector && sibling.querySelector('input[data-action=\"quantity\"]');\n          if (input) break;\n          sibling = sibling.nextElementSibling;\n        }\n        if (!input) return;\n\n        const current = Number.parseInt(input.value) || 1;\n        const newQty = Math.max(1, current + change);\n        input.value = newQty;\n\n        await pb.collection('cart').update(id, { quantity: newQty });\n        window.dispatchEvent(new CustomEvent('cart-updated'));\n      } catch (err) {\n        console.error('Failed to update quantity:', err);\n      }\n    }\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n});\n"]}