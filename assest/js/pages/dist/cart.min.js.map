{"version":3,"sources":["cart.js"],"names":["_cartItem","require","_pocketbase","cartItem","CartItem","searchCart","query","cartItems","document","querySelectorAll","lowerQuery","toLowerCase","forEach","item","name","querySelector","textContent","includes","display","lowerItemName","user","data","cartContainer","regeneratorRuntime","async","_context","prev","next","getCurrentUser","id","console","warn","abrupt","awrap","pb","collection","getFullList","filter","concat","displayCart","sent","pd","productData","expand","product","cartSection","createElement","className","dataset","innerHTML","files","getURL","image","quantity","price","toFixed","originalPrice","t0","error","stop","DeleteAllCart","getElementById","addEventListener","_context2","attachEventListeners","e","btn","action","_context3","target","closest","updateQuantity","remove","input","currentQuantity","_context4","value","parseInt","update","calculateItemPrice","paymentSummary","subtotal","shipping","tax","total","_context5","itemTotal","length","checkAuth","isAuthenticated","window","location","href","displayUsername","userName","user_name","authStore","model","logOut","clear","logOutBtn","checkOut","continueShopping","search","TAX_RATE","check"],"mappings":"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","file":"cart.min.js","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\n\nfunction searchCart(query) {\n    const cartItems = document.querySelectorAll('.cart-item');\n    const lowerQuery = query.toLowerCase();\n\n    cartItems.forEach(item => {\n        const name = item.querySelector('.item-name')\n        if(!name) return;\n\n        let itemName = name.textContent\n        const lowerItemName = itemName.toLowerCase();\n        if(lowerItemName.includes(lowerQuery)) {\n            item.style.display = 'flex';\n        }\n        else {\n            item.style.display = 'none';\n        }\n    })\n}\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${pd.quantity}\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\n\nfunction DeleteAllCart() {\n   const del = document.getElementById('clear-cart');\n   del.addEventListener('click', async () => {\n       await pb.collection('cart').delete();\n       cartItem.remove();\n   })\n}\n\n function attachEventListeners(item) {\n    item.addEventListener('click', async (e) => {\n        const btn = e.target.closest('button');\n        const action = btn ? btn.dataset.action : null;\n        if (action === \"decrease\") {\n            await updateQuantity(item, action)\n        } else if (action === \"increase\") {\n            await updateQuantity(item, action)\n        } else if (action === \"remove\") {\n            cartItem.remove(item);\n        }\n    })\n}\n\nasync function updateQuantity(item, action) {\n    const input = item.querySelector('[data-action=\"quantity\"]');\n    const quantity = input.value;\n    const currentQuantity = parseInt(quantity);\n\n    if(action === \"increase\") {\n        input.value = currentQuantity + 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity + 1\n        })\n    } else if(action === \"decrease\") {\n        input.value = currentQuantity - 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity - 1\n        })\n    }\n}\n\nasync function calculateItemPrice() {\n    const paymentSummary = document.querySelector('.summary-details');\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    let subtotal = 0;\n    let shipping = 0;\n    const TAX_RATE = 0.0005;\n\ndata.forEach(pd => {\n  const product = pd.expand.product;\n  const itemTotal = product.price * pd.quantity;\n  subtotal += itemTotal;\n  shipping += product.price * 0.001 * pd.quantity;\n});\n\nconst tax = subtotal * TAX_RATE;\nconst total = subtotal + shipping + tax;\n\n    paymentSummary.innerHTML = \n    `\n        <div class=\"summary-row\">\n            <span>Subtotal (<span id=\"total-items\">${data.length}</span> ${data.length > 1 ? 'items' : 'item'})</span>\n            <span id=\"subtotal\">$${subtotal.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Shipping</span>\n            <span id=\"shipping\">$${shipping.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Tax</span>\n            <span id=\"tax\">$${tax.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row discount\" id=\"discount-row\" style=\"display: none\">\n            <span>Discount</span>\n            <span id=\"discount\">-$0.00</span>\n        </div>\n        <div class=\"summary-divider\"></div>\n        <div class=\"summary-row total\">\n            <span>Total</span>\n            <span id=\"total\">$${total.toFixed(2)}</span>\n        </div>\n    `\n}\n\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n    calculateItemPrice();\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n\nconst checkOut = document.querySelector('.checkout-btn');\ncheckOut.addEventListener('click', () => {\n    window.location.href = '/public/checkout.html';\n});\n\nconst continueShopping = document.querySelector('.continue-shopping-btn');\ncontinueShopping.addEventListener('click', () => {\n    window.location.href = '/public/products.html';\n});\n\nconst search = document.querySelector('.search-input')\nsearch.addEventListener('input', () => {\n    const searchItem = search.value;\n    searchCart(searchItem);\n});\n\nconst check = document.querySelector('.dashboard, .cart, .orders, .analytics, .settings');\nif (check) {\n  check.addEventListener('click', () => {\n   if(!isAuthenticated()) {\n    window.location.href = '/public/auth/auth.html';\n   }\n  });\n}\n\nexport { calculateItemPrice, checkAuth, displayUsername, logOut, getCurrentUser };"]}