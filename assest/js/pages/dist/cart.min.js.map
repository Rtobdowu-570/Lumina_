{"version":3,"sources":["cart.js"],"names":["_cartItem","require","_pocketbase","cartItem","CartItem","displayCart","user","data","cartContainer","regeneratorRuntime","async","_context","prev","next","getCurrentUser","id","console","warn","abrupt","awrap","pb","collection","getFullList","filter","concat","sent","document","querySelector","forEach","pd","productData","expand","product","cartSection","createElement","className","dataset","innerHTML","files","getURL","image","name","quantity","price","toFixed","originalPrice","appendChild","attachEventListeners","t0","error","stop","item","addEventListener","e","btn","action","_context2","target","closest","updateQuantity","remove","input","value","currentQuantity","parseInt","update","calculateItemPrice","paymentSummary","subtotal","shipping","tax","total","_context4","log","paymentData","length","checkAuth","isAuthenticated","window","location","href","displayUsername","userName","textContent","user_name","authStore","model","logOut","clear","logOutBtn"],"mappings":"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","file":"cart.min.js","sourcesContent":["import { CartItem } from \"../components/cart-item.js\";\nimport { pb, isAuthenticated } from '../api/pocketbase.js';\n\nconst cartItem = new CartItem();\n\nasync function displayCart() {\n    try {\n        const user = getCurrentUser();\n        if (!user || !user.id) {\n            console.warn('No authenticated user');\n            return;\n        }\n\n        const data = await pb.collection('cart').getFullList({\n            filter: `user = '${user.id}'`,\n            expand: 'product'\n        });\n\n        const cartContainer = document.querySelector('.cart-items');\n        if (!cartContainer) {\n            console.warn('Cart container not found');\n            return;\n        }\n        \n        data.forEach(pd => {\n            const productData = pd.expand.product;\n            const cartSection = document.createElement('div')\n            cartSection.className = 'cart-item'\n            cartSection.dataset.id = pd.id\n\n            cartSection.innerHTML += \n            `\n            <div class=\"item-image\"><img src=\"${pb.files.getURL(productData, productData.image)}\" alt=\"${productData.name}\"></div>\n            <div class=\"item-details\">\n                <h3 class=\"item-name\">${productData.name}</h3>\n            </div>\n        <div class=\"item-quantity\">\n            <button class=\"qty-btn\" data-action=\"decrease\">‚àí</button>\n            <input type=\"number\" value=\"${pd.quantity}\" min=\"1\" data-action=\"quantity\">\n            <button class=\"qty-btn\" data-action=\"increase\">+</button>\n        </div>\n        <div class=\"item-price\">\n            <div class=\"price-current\">$${productData.price.toFixed(2)}</div>\n            ${\n              productData.originalPrice\n                ? `<div class=\"price-original\">$${productData.originalPrice.toFixed(\n                    2\n                  )}</div>`\n                : \"\"\n            }\n        </div>\n         <div class=\"item-actions\">\n            <button class=\"remove-btn\" data-action=\"remove\">üóëÔ∏è</button>\n        </div>\n            `\n            cartContainer.appendChild(cartSection)\n            attachEventListeners(cartSection);\n            return cartSection;\n          });\n    } catch (err) {\n        console.error('Failed to display cart:', err);\n    }\n}\n\n function attachEventListeners(item) {\n    item.addEventListener('click', async (e) => {\n        const btn = e.target.closest('button');\n        const action = btn ? btn.dataset.action : null;\n        if (action === \"decrease\") {\n            await updateQuantity(item, action)\n        } else if (action === \"increase\") {\n            await updateQuantity(item, action)\n        } else if (action === \"remove\") {\n            cartItem.remove(item);\n        }\n    })\n}\n\nasync function updateQuantity(item, action) {\n    const input = item.querySelector('[data-action=\"quantity\"]');\n    const quantity = input.value;\n    const currentQuantity = parseInt(quantity);\n\n    if(action === \"increase\") {\n        input.value = currentQuantity + 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity + 1\n        })\n    } else if(action === \"decrease\") {\n        input.value = currentQuantity - 1;\n        await pb.collection('cart').update(item.dataset.id, {\n            quantity: currentQuantity - 1\n        })\n    }\n}\n\nasync function calculateItemPrice() {\n    const paymentSummary = document.querySelector('.summary-details');\n    const data = await pb.collection('cart').getFullList({\n        filter: `user = \"${getCurrentUser().id}\"`,\n        expand: 'product'\n    });\n\n    console.log(data);\n\n    // Calculate totals for all items\n    let subtotal = 0;\n    data.forEach(pd => {\n        const paymentData = pd.expand.product;\n        subtotal += pd.quantity * paymentData.price;\n    });\n\n    const shipping = subtotal * 0.01;\n    const tax = (subtotal * 0.05) * 0.05;\n    const total = subtotal + shipping + tax;\n\n    paymentSummary.innerHTML = \n    `\n        <div class=\"summary-row\">\n            <span>Subtotal (<span id=\"total-items\">${data.length}</span> ${data.length > 1 ? 'items' : 'item'})</span>\n            <span id=\"subtotal\">$${subtotal.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Shipping</span>\n            <span id=\"shipping\">$${shipping.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row\">\n            <span>Tax</span>\n            <span id=\"tax\">$${tax.toFixed(2)}</span>\n        </div>\n        <div class=\"summary-row discount\" id=\"discount-row\" style=\"display: none\">\n            <span>Discount</span>\n            <span id=\"discount\">-$0.00</span>\n        </div>\n        <div class=\"summary-divider\"></div>\n        <div class=\"summary-row total\">\n            <span>Total</span>\n            <span id=\"total\">$${total.toFixed(2)}</span>\n        </div>\n    `\n}\n\n\nfunction checkAuth() {\n    if (!isAuthenticated()) {\n        window.location.href = '/public/auth/auth.html';\n    }\n}\n\nfunction displayUsername() {\n    const user =  getCurrentUser()\n    const userName = document.querySelector('.user-name');\n\n    if (isAuthenticated()) {\n      if(user.name) {\n        userName.textContent = user.name;\n      } else {\n        userName.textContent = user.user_name;\n      }\n    }\n    else {\n      userName.textContent = \"Guest\";\n}\n}\n\nfunction getCurrentUser() {\n    return pb.authStore.model;\n}\n\nfunction logOut() {\n    pb.authStore.clear(); \n    window.location.href = '/auth/login.html';\n}\n\ndocument.addEventListener('DOMContentLoaded',  () => {\n   displayCart();\n    checkAuth();\n    displayUsername();\n    calculateItemPrice();\n});\n\nconst logOutBtn = document.querySelector('.log-out');\nlogOutBtn.addEventListener('click', () => {\n    logOut();\n});\n"]}